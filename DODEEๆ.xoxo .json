{
  "name": "DODEEà¹†.xoxo",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.raw_text }}",
        "options": {
          "systemMessage": "=à¸„à¸¸à¸“à¸„à¸·à¸­à¸œà¸¹à¹‰à¹€à¸Šà¸µà¹ˆà¸¢à¸§à¸Šà¸²à¸à¸”à¹‰à¸²à¸™à¸à¸²à¸£à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥à¹€à¸­à¸à¸ªà¸²à¸£à¸—à¸²à¸‡à¸à¸²à¸£à¹€à¸‡à¸´à¸™ à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸‚à¸­à¸‡à¸„à¸¸à¸“à¸„à¸·à¸­à¸à¸²à¸£à¸­à¹ˆà¸²à¸™à¹à¸¥à¸°à¸ªà¸à¸±à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸ªà¸³à¸„à¸±à¸à¸ˆà¸²à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ªà¸¥à¸´à¸›à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡ à¹à¸¥à¸°à¸ªà¹ˆà¸‡à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¹ƒà¸™à¸£à¸¹à¸›à¹à¸šà¸š JSON Object à¸—à¸µà¹ˆà¸¡à¸µà¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸Šà¸±à¸”à¹€à¸ˆà¸™\n\nà¸‚à¹‰à¸­à¸à¸³à¸«à¸™à¸”:\n- à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸ªà¸à¸±à¸”: \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™\", \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š\", \"à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™\", \"à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£\", \"à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡\", \"à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³\", \"à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£\"\n\n- à¸ªà¸³à¸«à¸£à¸±à¸š \"à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£\" : à¹ƒà¸«à¹‰à¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­à¸˜à¸™à¸²à¸„à¸²à¸£à¸ˆà¸²à¸à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸”à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™ à¸ªà¸à¸±à¸”à¸ˆà¸²à¸à¸£à¸¹à¸›à¹à¸šà¸šà¸‚à¸­à¸‡à¸ªà¸¥à¸µà¸›à¹ƒà¸«à¹‰à¹„à¸”à¹‰ à¸«à¸²à¸à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸£à¸°à¸šà¸¸à¹„à¸”à¹‰à¸•à¹‰à¸­à¸‡à¸žà¸¢à¸²à¸¢à¸²à¸¡à¸ˆà¸™à¸à¸§à¹ˆà¸²à¸ˆà¸°à¹„à¸”à¹‰  à¸–à¹‰à¸²à¸„à¸´à¸”à¸§à¹ˆà¸²à¸žà¸¢à¸²à¸¢à¸²à¸¡à¸¡à¸²à¸à¸žà¸­ à¸ˆà¸™à¸«à¸¡à¸”à¸«à¸™à¸—à¸²à¸‡à¸ˆà¸£à¸´à¸‡à¹†à¹à¸¥à¹‰à¸§ à¹ƒà¸«à¹‰à¹ƒà¸ªà¹ˆà¸„à¹ˆà¸²à¹€à¸›à¹‡à¸™ null\n\nà¸£à¸²à¸¢à¸à¸²à¸£à¸Šà¸·à¹ˆà¸­à¸˜à¸™à¸²à¸„à¸²à¸£à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰: KTB (à¸à¸£à¸¸à¸‡à¹„à¸—à¸¢, Krungthai), KBank (à¸à¸ªà¸´à¸à¸£, à¸à¸ªà¸´à¸à¸£à¹„à¸—à¸¢, KBank), BBL (à¸˜à¸™à¸²à¸„à¸²à¸£à¸à¸£à¸¸à¸‡à¹€à¸—à¸ž, Bangkok Bank), MyMo (à¸­à¸­à¸¡à¸ªà¸´à¸™), SCB (à¸˜à¸™à¸²à¸„à¸²à¸£à¹„à¸—à¸¢à¸žà¸²à¸“à¸´à¸Šà¸¢à¹Œ, à¹„à¸—à¸¢à¸žà¸²à¸“à¸´à¸Šà¸¢à¹Œ), PromptPay (à¸žà¸£à¹‰à¸­à¸¡à¹€à¸žà¸¢à¹Œ), MAKEbyKBank (makebyKbank, MAKE, Make,MakebyKbank)\n\n- \"à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™\" à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹€à¸¥à¸‚à¸—à¸¨à¸™à¸´à¸¢à¸¡à¸ªà¸­à¸‡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ à¹à¸¥à¸°à¸–à¹‰à¸²à¸ªà¸¥à¸´à¸›à¹€à¸›à¹‡à¸™à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™à¸­à¸·à¹ˆà¸™ à¹ƒà¸«à¹‰à¸£à¸°à¸šà¸¸à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™à¸™à¸±à¹‰à¸™à¸”à¹‰à¸§à¸¢ à¹à¸¥à¸°à¸–à¹‰à¸²à¹€à¸›à¹‡à¸™à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™à¸•à¹ˆà¸²à¸‡à¸›à¸£à¸°à¹€à¸—à¸¨ à¹ƒà¸«à¹‰à¸£à¸°à¸šà¸¸à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™à¸”à¹‰à¸§à¸¢ à¹€à¸Šà¹ˆà¸™ \"4836.00 JPY\"  \n- à¸–à¹‰à¸²à¸¡à¸µà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸™à¸ à¸²à¸©à¸²à¸ˆà¸µà¸™à¸«à¸£à¸·à¸­à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™à¸ à¸²à¸©à¸­à¸±à¸‡à¸à¸¤à¸© à¹ƒà¸«à¹‰à¹à¸›à¸¥à¹€à¸›à¹‡à¸™à¹„à¸—à¸¢à¹ƒà¸™à¸§à¸‡à¹€à¸¥à¹‡à¸šà¸«à¸¥à¸±à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¹‰à¸™à¸‰à¸šà¸±à¸š à¹€à¸Šà¹ˆà¸™ `\"AEON SAPPOROSOEN, HOKKAIDO (à¸­à¸´à¸­à¸­à¸™ à¸‹à¸±à¸›à¹‚à¸›à¹‚à¸£à¹‚à¸‹à¹€à¸­à¹‡à¸™, à¸®à¸­à¸à¹„à¸à¹‚à¸”) à¸«à¸£à¸·à¸­à¸­à¸·à¹ˆà¸™à¹† à¹€à¸Šà¹ˆà¸™ FOBIESIM, SHIBUYA-KU\"`  \n- \"à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£\" à¹ƒà¸«à¹‰à¸ªà¸à¸±à¸”à¸—à¸±à¹‰à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆà¹à¸¥à¸°à¹€à¸§à¸¥à¸²\n-\"à¹ƒà¸«à¹‰à¹à¸¢à¸ 'à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™' à¹à¸¥à¸° 'à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™' à¸­à¸­à¸à¹€à¸›à¹‡à¸™à¸„à¸™à¸¥à¸°à¸Ÿà¸´à¸¥à¸”à¹Œà¹€à¸ªà¸¡à¸­ à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸žà¸šà¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™ à¹ƒà¸«à¹‰à¹ƒà¸ªà¹ˆà¸„à¹ˆà¸²à¹€à¸›à¹‡à¸™ 'THB'\"  \n\nà¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ JSON\n\n{\n  \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™\": \"AEON SAPPOROSOEN, HOKKAIDO\",\n  \"à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™\": \"4836.00\",\n  \"à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™\": \"JPY\",\n  \"à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£\": \"03 Jun 2025, 08:05PM\",\n  ...\n}\n\n\n- **à¸ªà¸³à¸„à¸±à¸: à¸ªà¸³à¸«à¸£à¸±à¸š \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™\" à¹à¸¥à¸° \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š\" à¸«à¸²à¸à¸Šà¸·à¹ˆà¸­à¹ƒà¸™à¸ªà¸¥à¸´à¸›à¸‹à¹‰à¸³à¸à¸±à¸™ à¹ƒà¸«à¹‰à¸”à¸¶à¸‡à¸Šà¸·à¹ˆà¸­à¸•à¸²à¸¡à¸—à¸µà¹ˆà¸£à¸°à¸šà¸¸à¹ƒà¸™à¸ªà¸¥à¸´à¸›à¸ˆà¸£à¸´à¸‡ à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸‚à¸­à¸‡à¸«à¸±à¸§à¸‚à¹‰à¸­ \"à¸ˆà¸²à¸\" à¹€à¸žà¸·à¹ˆà¸­à¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™ à¹à¸¥à¸°à¸«à¸±à¸§à¸‚à¹‰à¸­ \"à¹„à¸›à¸¢à¸±à¸‡\" à¹€à¸žà¸·à¹ˆà¸­à¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸šà¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸„à¸£à¹ˆà¸‡à¸„à¸£à¸±à¸” à¹ƒà¸«à¹‰à¸”à¸¶à¸‡à¸Šà¸·à¹ˆà¸­à¸•à¸²à¸¡à¸—à¸µà¹ˆà¸›à¸£à¸²à¸à¸à¹ƒà¸™à¸ªà¸¥à¸´à¸›à¸ˆà¸£à¸´à¸‡ à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸ªà¸£à¸¸à¸›à¸«à¸£à¸·à¸­à¹à¸à¹‰à¹„à¸‚**\n\n- **à¹ƒà¸«à¹‰à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸”à¸´à¸šà¸—à¸µà¹ˆà¸ªà¸¸à¸”à¹€à¸—à¹ˆà¸²à¸—à¸µà¹ˆà¸ˆà¸°à¹€à¸›à¹‡à¸™à¹„à¸›à¹„à¸”à¹‰ à¹‚à¸”à¸¢à¹€à¸™à¹‰à¸™à¸„à¸§à¸²à¸¡à¹à¸¡à¹ˆà¸™à¸¢à¸³à¸‚à¸­à¸‡à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£à¹à¸¥à¸°à¸•à¸±à¸§à¹€à¸¥à¸‚à¹€à¸›à¹‡à¸™à¸«à¸¥à¸±à¸**\n- à¸«à¹‰à¸²à¸¡à¹€à¸žà¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ à¸«à¸£à¸·à¸­à¸ªà¸±à¸à¸¥à¸±à¸à¸©à¸“à¹Œà¹ƒà¸”à¹† à¸™à¸­à¸à¹€à¸«à¸™à¸·à¸­à¸ˆà¸²à¸ JSON Object\n\nà¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ JSON Output à¸—à¸µà¹ˆà¸„à¸²à¸”à¸«à¸§à¸±à¸‡:\n{\nÂ  \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™\": \"à¸ªà¸¡à¸Šà¸²à¸¢ à¹ƒà¸ˆà¸”à¸µ\",\nÂ  \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š\": \"TICKETIER\",\nÂ  \"à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™\": \"500.00\",\nÂ  \"à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£\": \"11/07/2568 12:38\",\nÂ  \"à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡\": \"64C90NJA9OKH4AY90RV\",\nÂ  \"à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³\": null,\nÂ  \"à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£\": \"SCB\",\nÂ \n}\n\n\n\nà¸ªà¸à¸±à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸”à¸´à¸šà¸™à¸µà¹‰à¹à¸¥à¸°à¸ªà¹ˆà¸‡à¸à¸¥à¸±à¸šà¸¡à¸²à¹ƒà¸™à¸£à¸¹à¸›à¹à¸šà¸š JSON à¸•à¸²à¸¡à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™:"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        -7168,
        -1104
      ],
      "id": "04704f74-aa58-4e9e-b94e-0a6f04933a5b",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -7216,
        -912
      ],
      "id": "0f06a800-77ba-4514-86e4-c4bc7f67ad3d",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "9rCGzNq8kpxIepft",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "="
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -7072,
        -896
      ],
      "id": "ead66f33-99b3-4db4-aa1f-8204cea39405",
      "name": "Simple Memory",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "96551dd0-14a0-40d2-b770-5d11e615ef60",
              "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
              "rightValue": "=à¸˜à¸™à¸²à¸„à¸²à¸£à¸à¸£à¸¸à¸‡à¹€à¸—à¸ž",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "09233987-8a86-44fd-b636-e89b1004ca0d",
              "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
              "rightValue": "à¸˜à¸™à¸²à¸„à¸²à¸£à¸à¸£à¸¸à¸‡à¹„à¸—à¸¢",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "95fbd385-ac99-4290-8b59-cf540da9c7af",
              "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
              "rightValue": "KBank",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "51fa73bb-8b00-4255-9db0-5d778890ed45",
              "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
              "rightValue": "à¸˜à¸™à¸²à¸„à¸²à¸£à¹„à¸—à¸¢à¸žà¸²à¸“à¸´à¸Šà¸¢à¹Œ ",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "a40dccd7-b358-4bdd-bbcd-f35a905e59d6",
              "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
              "rightValue": "à¸˜à¸™à¸²à¸„à¸²à¸£à¸­à¸­à¸¡à¸ªà¸´à¸™",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "3d9fc9a7-d284-4cb4-9471-bf2b4dddbe8b",
              "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
              "rightValue": "SCB",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "6f0ead75-82cf-4250-bbe0-801b12874b30",
              "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
              "rightValue": "KTB",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "d6c85175-7846-40c2-89c2-95b3dea0c9fa",
              "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
              "rightValue": "MyMo",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "2c88d64a-61b6-4a75-a4c6-07ddb0f83d3e",
              "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
              "rightValue": "BBL",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "f799b96f-c936-4377-b039-c163a8a82f56",
              "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
              "rightValue": "MAKEbyKBank",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -6736,
        -1504
      ],
      "id": "528f3dca-dbfb-437a-974f-08b5c2f615da",
      "name": "If"
    },
    {
      "parameters": {
        "jsCode": "// à¸”à¸¶à¸‡à¸„à¹ˆà¸² output à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™ String à¸ˆà¸²à¸ AI Agent\nconst aiOutputString = $json.output;\n\n// à¸¥à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™à¸­à¸­à¸ (à¹€à¸Šà¹ˆà¸™ ```json\\n à¹à¸¥à¸° ```)\nlet cleanedString = aiOutputString.replace(/```json\\n|```/g, '');\n\n// à¹à¸›à¸¥à¸‡ String à¸—à¸µà¹ˆà¸ªà¸°à¸­à¸²à¸”à¹à¸¥à¹‰à¸§à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™ JSON Object\nlet parsedData = {};\ntry {\n  parsedData = JSON.parse(cleanedString);\n} catch (e) {\n  // à¸«à¸²à¸à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹à¸›à¸¥à¸‡ JSON à¹ƒà¸«à¹‰à¸ªà¹ˆà¸‡à¸„à¹ˆà¸² Error à¹à¸—à¸™\n  return { error: \"à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹à¸›à¸¥à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ AI Agent à¹„à¸”à¹‰\" };\n}\n\n// à¸ªà¹ˆà¸‡à¸„à¸·à¸™ JSON Object à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡\nreturn [parsedData];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6736,
        -1088
      ],
      "id": "8229dd70-3c97-42cc-b7ca-1486de2fe947",
      "name": "JS-AI"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“«à¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸ à¹€à¸ªà¸£à¹‡à¸ˆà¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¸„à¹ˆà¸°ðŸœï¸\nðŸ§‘â€ðŸš€à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™ :{{ $json.items[0]['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}\nðŸ‹ï¸à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š :{{ $json.items[0]['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}\nðŸ’°à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™ :{{ $json.items[0]['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] }} à¸šà¸²à¸—\nâ°à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£ :{{ $json.items[0]['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] }}\nðŸ“ðŸ¥‘ðŸ‡ðŸ“ðŸ†âœ¨ðŸ‡ðŸ¤¶ðŸœï¸ðŸŒŠðŸª¬ðŸ©ºðŸ’°ðŸª™â˜Žï¸ðŸ—ï¸ðŸª’ðŸª­ðŸ§£ðŸ–ï¸ðŸ«§ðŸ§½ðŸª¥\nðŸ¥½à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³ :{{ $json.items[0]['à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³'] }}\nðŸŒˆà¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£ :{{ $json.items[0]['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}\nðŸŒ½à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡ :{{ $json.items[0]['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] }}\nðŸ’¯ðŸ’—â¤ï¸ðŸ©·ðŸ§¡ðŸ’›ðŸ’šðŸ’™ðŸ©µðŸ’œðŸ¤ŽðŸ–¤ðŸ©¶ðŸ¤ðŸ’¯",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -4032,
        -1776
      ],
      "id": "e995f047-9824-4c73-88af-b48eb398b8c1",
      "name": "SAVE",
      "webhookId": "b11471a5-95c1-4f15-8ca0-e8d7d1456f21",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Loop Over Items').item.json.chatId }}",
        "text": "\"à¸¡à¸µà¸ªà¸¥à¸´à¸›à¸ˆà¸²à¸à¸à¸²à¸£à¸—à¸³à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¸•à¹ˆà¸²à¸‡à¸›à¸£à¸°à¹€à¸—à¸¨à¸ˆà¹‰à¸²\"",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -5840,
        -1168
      ],
      "id": "c81409be-d8bb-4237-a42c-a675ee6df534",
      "name": "exchanges",
      "webhookId": "b11471a5-95c1-4f15-8ca0-e8d7d1456f21",
      "disabled": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
                    "rightValue": "KTB",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "359c0581-9e57-43aa-ad94-e8c0ae2cc5b6"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4efbb30f-5042-4772-8de1-09d248599736",
                    "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
                    "rightValue": "MAKEbyKBank",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "238333ae-2760-4c1a-a814-9f2e519af922",
                    "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
                    "rightValue": "SCB",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "47492068-6d41-4c0d-9879-eb3dff3911e9",
                    "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
                    "rightValue": "BBL",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8289ec14-6337-4303-8e8b-3cec224727e5",
                    "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
                    "rightValue": "MyMo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9bcc8619-8565-41f7-8aec-b107eba46597",
                    "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
                    "rightValue": " KBank",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -6176,
        -1808
      ],
      "id": "10330edf-44bf-45b4-8f66-2cf513bc1f0c",
      "name": "Switch"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 380061002,
          "mode": "list",
          "cachedResultName": "MAKEbyKbank",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=380061002"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡": "={{ $json['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}",
            "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™": "={{ $json['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] }}",
            "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£": "={{ $json['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] }}",
            "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³": "={{ $json['à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³'] }}",
            "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}"
          },
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "displayName": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -5456,
        -1984
      ],
      "id": "8836a49f-bd52-4d52-bf76-d1e5d9fbeec2",
      "name": "MAKE",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "KTB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡": "={{ $json['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}",
            "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™": "={{ $json['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] }}",
            "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£": "={{ $json.raw_parsed['à¸§à¸±à¸™à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] }}",
            "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³": "={{ $json['à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³'] }}",
            "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}"
          },
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "displayName": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -5472,
        -2192
      ],
      "id": "5f8b8e7f-1306-4cd4-a9a6-5a2b78d1fcc7",
      "name": "KTB",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 160558656,
          "mode": "list",
          "cachedResultName": "SCB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=160558656"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "displayName": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ",
              "displayName": "à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "raw_parsed",
              "displayName": "raw_parsed",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "raw_text",
              "displayName": "raw_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "confidence_score",
              "displayName": "confidence_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -5456,
        -1792
      ],
      "id": "1ef0415e-56e2-4184-a887-e4a93a009fe7",
      "name": "SCB",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1334248226,
          "mode": "list",
          "cachedResultName": "BBL",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=1334248226"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡": "{{ $json['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] }}"
          },
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "displayName": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -5456,
        -1600
      ],
      "id": "cd57458c-5447-4743-827f-924d6d811b51",
      "name": "BBL",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 913554616,
          "mode": "list",
          "cachedResultName": "MyMo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=913554616"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡": "={{ $json['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}",
            "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™": "={{ $json['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] }}",
            "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£": "={{ $json['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] }}",
            "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³": "={{ $json['à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³'] }}",
            "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}"
          },
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "displayName": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -5456,
        -1408
      ],
      "id": "2bf44bb4-01f0-473e-b850-b10fd8fa02d6",
      "name": "MyMo",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Node: bigestF (FIXED FOR BATCHING v2)\n// âœ… à¸£à¸­à¸‡à¸£à¸±à¸š media_group (à¸«à¸¥à¸²à¸¢à¸£à¸¹à¸›à¸•à¹ˆà¸­à¸„à¸£à¸±à¹‰à¸‡) à¹à¸¥à¸° single upload\n// âœ… à¸ªà¸£à¹‰à¸²à¸‡ batchKey à¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡ à¹à¸¥à¸°à¹€à¸žà¸´à¹ˆà¸¡ timestamp à¸›à¹‰à¸­à¸‡à¸à¸±à¸™ collision\n\nconst msg = $json.message || $json;\nconst items = [];\nconst chatId = msg.chat?.id || null;\nconst mediaGroupId = msg.media_group_id || null;\nconst timestamp = msg.date || Date.now(); // à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸Šà¸™à¸à¸±à¸™à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ batch à¸‹à¹‰à¸³à¹€à¸§à¸¥à¸²à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™\n\n// ðŸ’¡ à¹ƒà¸Šà¹‰ batchKey à¹€à¸žà¸·à¹ˆà¸­ group à¸£à¸¹à¸› slip à¸—à¸µà¹ˆà¸¡à¸²à¸žà¸£à¹‰à¸­à¸¡à¸à¸±à¸™\nconst batchKey = mediaGroupId\n  ? `group_${chatId}_${mediaGroupId}`\n  : `single_${chatId}_${timestamp}`;\n\n// --- Handle case: photo (1 à¸£à¸¹à¸›à¸«à¸£à¸·à¸­à¸«à¸¥à¸²à¸¢à¸£à¸¹à¸›à¹ƒà¸™ media group) ---\nif (msg.photo && Array.isArray(msg.photo) && msg.photo.length) {\n  // Telegram à¸ªà¹ˆà¸‡à¸£à¸¹à¸›à¸«à¸¥à¸²à¸¢à¸‚à¸™à¸²à¸” -> à¹ƒà¸Šà¹‰à¸‚à¸™à¸²à¸”à¹ƒà¸«à¸à¹ˆà¸ªà¸¸à¸” (à¸­à¸±à¸™à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢)\n  const largestPhoto = msg.photo[msg.photo.length - 1];\n  items.push({\n    json: {\n      type: \"slip\",\n      fileId: largestPhoto.file_id,\n      chatId,\n      media_group_id: mediaGroupId,\n      batchKey, // à¹ƒà¸Šà¹‰à¹ƒà¸™à¸à¸²à¸£à¸£à¸§à¸¡ batch à¸ à¸²à¸¢à¸«à¸¥à¸±à¸‡\n    },\n  });\n}\n\n// --- Handle case: document (à¹€à¸Šà¹ˆà¸™ PDF à¸«à¸£à¸·à¸­ slip à¹à¸™à¸šà¹€à¸›à¹‡à¸™à¹„à¸Ÿà¸¥à¹Œ) ---\nelse if (msg.document) {\n  const ext = msg.document.mime_type || \"\";\n  items.push({\n    json: {\n      type: ext.includes(\"pdf\") ? \"statement\" : \"document\",\n      fileId: msg.document.file_id,\n      chatId,\n      media_group_id: mediaGroupId,\n      batchKey,\n    },\n  });\n}\n\n// --- à¸à¸£à¸“à¸µà¹„à¸¡à¹ˆà¸žà¸šà¹„à¸Ÿà¸¥à¹Œà¹€à¸¥à¸¢ ---\nelse {\n  items.push({\n    json: { error: \"No file found\", chatId },\n  });\n}\n\nreturn items;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -10512,
        -960
      ],
      "id": "0dbe9a8d-38ab-495f-a2fc-cfaba3178f74",
      "name": "bigestF"
    },
    {
      "parameters": {
        "jsCode": "// ParseSlip - ULTIMATE Consolidated (n8n Function node) - Execute Once\n// Banks supported: KTB, KBank, MAKEbyKBank, BBL, MyMo, SCB, PromptPay\n\n// ---------------- Helpers ----------------\nfunction thaiDigitsToLatin(s) {\n  if (s === null || s === undefined) return s;\n  const map = {'à¹':'0','à¹‘':'1','à¹’':'2','à¹“':'3','à¹”':'4','à¹•':'5','à¹–':'6','à¹—':'7','à¹˜':'8','à¹™':'9'};\n  return String(s).replace(/[à¹-à¹™]/g, ch => map[ch] || ch);\n}\n\nfunction normalizeAmount(s) {\n  if (s === null || s === undefined) return null;\n  let t = String(s).trim();\n  t = thaiDigitsToLatin(t);\n  t = t.replace(/[^\\d\\.,\\-\\(\\)]/g, '');\n  let negative = false;\n  if (/^\\(.*\\)$/.test(t)) { negative = true; t = t.replace(/^\\(|\\)$/g,''); }\n  if (/^-/.test(t)) { negative = true; t = t.replace(/^-/, ''); }\n\n  if (t.indexOf('.') !== -1 && t.indexOf(',') !== -1) {\n    if (t.lastIndexOf(',') > t.lastIndexOf('.')) {\n      t = t.replace(/\\./g, '').replace(',', '.');\n    } else {\n      t = t.replace(/,/g, '');\n    }\n  } else if (t.indexOf(',') !== -1 && t.indexOf('.') === -1) {\n    const parts = t.split(',');\n    const last = parts[parts.length - 1];\n    if (last.length === 2) t = t.replace(/,/g, '.');\n    else t = t.replace(/,/g, '');\n  } else {\n    t = t.replace(/,/g, '');\n  }\n\n  t = t.replace(/[^\\d.]/g, '');\n  if (t === '') return null;\n  const num = parseFloat(t);\n  if (isNaN(num)) return null;\n  return (negative ? -num : num).toFixed(2);\n}\n\nfunction normalizeDateRaw(s) {\n  if (!s) return null;\n  let str = String(s).trim();\n  str = thaiDigitsToLatin(str);\n  str = str.replace(/\\s*à¸™\\.?$/i, '').trim();\n\n  // ISO-ish\n  let m = str.match(/(20\\d{2})[\\/\\-](\\d{1,2})[\\/\\-](\\d{1,2})(?:[ T](\\d{1,2}:\\d{2}(?::\\d{2})?))?/);\n  if (m) {\n    const y = m[1], mo = String(m[2]).padStart(2,'0'), d = String(m[3]).padStart(2,'0');\n    let time = m[4] || '00:00:00'; if (time.length === 5) time += ':00';\n    return y + '-' + mo + '-' + d + ' ' + time;\n  }\n\n  // dd/mm/yyyy hh:mm\n  m = str.match(/(\\d{1,2}\\/\\d{1,2}\\/\\d{2,4})\\s+(\\d{1,2}:\\d{2}(?::\\d{2})?)/);\n  if (m) {\n    const parts = m[1].split('/');\n    let d = parts[0].padStart(2,'0'), mo = parts[1].padStart(2,'0'), y = parts[2];\n    if (y.length === 2) {\n      const be = 2500 + parseInt(y,10);\n      y = String(be - 543);\n    } else if (parseInt(y,10) > 2500) {\n      y = String(parseInt(y,10) - 543);\n    }\n    let time = m[2]; if (time.length === 5) time += ':00';\n    return y + '-' + mo + '-' + d + ' ' + time;\n  }\n\n  // Thai month names\n  const thaiMonths = {\n    'à¸¡.à¸„':'01','à¸¡à¸„':'01','à¸¡.à¸„.':'01',\n    'à¸.à¸ž':'02','à¸à¸ž':'02','à¸.à¸ž.':'02',\n    'à¸¡à¸µ.à¸„':'03','à¸¡à¸µà¸„':'03','à¸¡à¸µ.à¸„.':'03',\n    'à¹€à¸¡.à¸¢':'04','à¹€à¸¡à¸¢':'04','à¹€à¸¡à¸¢.':'04',\n    'à¸ž.à¸„':'05','à¸žà¸„':'05','à¸ž.à¸„.':'05',\n    'à¸¡à¸´.à¸¢':'06','à¸¡à¸´à¸¢':'06','à¸¡à¸´.à¸¢.':'06',\n    'à¸.à¸„':'07','à¸à¸„':'07','à¸.à¸„.':'07',\n    'à¸ª.à¸„':'08','à¸ªà¸„':'08','à¸ª.à¸„.':'08',\n    'à¸.à¸¢':'09','à¸à¸¢':'09','à¸.à¸¢.':'09',\n    'à¸•.à¸„':'10','à¸•à¸„':'10','à¸•.à¸„.':'10',\n    'à¸ž.à¸¢':'11','à¸žà¸¢':'11','à¸ž.à¸¢.':'11',\n    'à¸˜.à¸„':'12','à¸˜à¸„':'12','à¸˜.à¸„.':'12'\n  };\n\n  m = str.match(/(\\d{1,2})\\s*([à¸-à¸®\\.]{1,6})\\s*(\\d{2,4})\\s*(?:[-,â€“]\\s*)?(\\d{1,2}:\\d{2}(?::\\d{2})?)?/i);\n  if (m) {\n    const day = String(m[1]).padStart(2,'0');\n    let monRaw = m[2].replace(/\\./g,'');\n    let month = null;\n    for (const k of Object.keys(thaiMonths)) {\n      const keyMatch = k.replace(/\\./g,'');\n      if (monRaw === keyMatch) { month = thaiMonths[k]; break; }\n    }\n    if (!month) {\n      for (const k of Object.keys(thaiMonths)) {\n        const keyMatch = k.replace(/\\./g,'');\n        if (monRaw.startsWith(keyMatch) || keyMatch.startsWith(monRaw)) { month = thaiMonths[k]; break; }\n      }\n    }\n    let yearRaw = m[3];\n    let yearNum = parseInt(yearRaw,10);\n    if (yearRaw.length === 2) {\n      const be = 2500 + yearNum;\n      yearNum = be - 543;\n    } else if (yearNum > 2500) {\n      yearNum = yearNum - 543;\n    }\n    const timeRaw = m[4];\n    let time = '00:00:00';\n    if (timeRaw) time = timeRaw.length === 5 ? timeRaw + ':00' : timeRaw;\n    if (month) return String(yearNum) + '-' + month + '-' + day + ' ' + time;\n  }\n\n  const ts = Date.parse(str);\n  if (!isNaN(ts)) return new Date(ts).toISOString().replace('T',' ').slice(0,19);\n  return null;\n}\n\n// ---------- line helpers & heuristics ----------\nfunction splitLines(raw) {\n  if (!raw) return [];\n  return raw.split(/\\r?\\n/).map(l => l.trim()).filter(l => l.length > 0);\n}\nfunction isDateLine(line) {\n  return /\\d{1,2}\\s*[à¸-à¸®\\.]{1,6}\\s*\\d{2,4}/.test(line) || /\\d{1,2}\\/\\d{1,2}\\/\\d{2,4}/.test(line) || /\\d{4}\\-\\d{2}\\-\\d{2}/.test(line);\n}\nfunction isAmountLine(line) {\n  return /([\\d\\.,]+\\.\\d{2})/.test(line);\n}\nfunction isAccountLine(line) {\n  return /(?:\\d{2,4}[x\\*\\-]{2,}\\d{2,6})|(?:\\d[\\d\\-\\s]{5,})/.test(line);\n}\nfunction isMerchantLine(line) {\n  return /(à¸šà¸£à¸´à¸©à¸±à¸—|à¸«à¸­à¸žà¸±à¸|à¸£à¹‰à¸²à¸™|SHOP|à¸„à¸­à¸£à¹Œà¸›à¸­à¹€à¸£à¸Šà¸±à¹ˆà¸™|à¸„à¸­à¸£à¹Œà¸›|à¸šà¸´à¸¥à¹€à¸¥à¸­à¸£à¹Œ|Biller|à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²|à¸›à¸´à¹‚à¸•à¸£à¹€à¸¥à¸µà¸¢à¸¡|à¸›à¸´à¹‚à¸•à¸£|GAS|STATION|PAY|TOPUP|à¹€à¸•à¸´à¸¡à¹€à¸‡à¸´à¸™|à¸›à¸±à¹Šà¸¡|à¸›à¸´à¹‚à¸•à¸£)/i.test(line);\n}\nfunction isPersonLine(line) {\n  return /^(à¸™à¸²à¸¢|à¸™à¸²à¸‡à¸ªà¸²à¸§|à¸™.à¸ª\\.|à¸™.à¸ª|à¸™à¸²à¸‡|à¸”à¸£\\.|à¸œà¸¨\\.|à¸£à¸¨\\.)/i.test(line) || (/[à¸-à¸®]{2,}\\s[à¸-à¸®]{2,}/.test(line) && !isMerchantLine(line) && !isAccountLine(line));\n}\nfunction noiseLine(line) {\n  return /^(mo|mymo|no|mm|nymo|momm|m|my|qr code|qr|scb|krungthai|à¸à¸£à¸¸à¸‡à¹„à¸—à¸¢|à¸ˆà¸³à¸™à¸§à¸™|à¸£à¸«à¸±à¸ª|à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚|à¸„à¹ˆà¸²à¸˜à¸£à¸£à¸¡à¹€à¸™à¸µà¸¢à¸¡|à¸£à¸²à¸¢à¸à¸²à¸£|EDC|K\\+|Kplus)/i.test(line);\n}\n\nfunction findNearestNameLine(lines, startIdx, direction = 1) {\n  let idx = startIdx;\n  while (idx >= 0 && idx < lines.length) {\n    const l = lines[idx].trim();\n    if (!noiseLine(l) && !isDateLine(l) && !isAmountLine(l) && l.length > 1) {\n      return l;\n    }\n    idx += direction;\n  }\n  return null;\n}\n\n// Extract sender/receiver with improved heuristics\nfunction extractNamesFromRaw(raw) {\n  const lines = splitLines(raw);\n  if (lines.length === 0) return {sender: null, receiver: null};\n\n  let sender = null, receiver = null;\n\n  // arrow / separator\n  const arrowIdx = lines.findIndex(l => l.trim() === 'â†“' || l.includes('->') || l.includes('v'));\n  if (arrowIdx > -1) {\n    sender = findNearestNameLine(lines, arrowIdx - 1, -1);\n    receiver = findNearestNameLine(lines, arrowIdx + 1, 1);\n    if (sender && receiver) return {sender, receiver};\n  }\n\n  // keyword logic\n  for (let i = 0; i < lines.length; i++) {\n    const L = lines[i];\n    if (!sender && (/^(?:à¸ˆà¸²à¸|From)[:\\s]*$/i.test(L) || /^à¸ˆà¸²à¸\\s+/i.test(L))) {\n      sender = findNearestNameLine(lines, i + 1, 1) || findNearestNameLine(lines, i - 1, -1);\n    }\n    if (!receiver && (/^(?:à¹„à¸›à¸¢à¸±à¸‡|à¸–à¸¶à¸‡|To|à¸œà¸¹à¹‰à¸£à¸±à¸š)[:\\s]*$/i.test(L) || /^(?:à¹„à¸›à¸¢à¸±à¸‡|à¸–à¸¶à¸‡|To)\\s+/i.test(L))) {\n      receiver = findNearestNameLine(lines, i + 1, 1) || findNearestNameLine(lines, i - 1, -1);\n    }\n  }\n\n  // merchant vs person heuristic\n  let merchant = null;\n  let person = null;\n  for (let i = 0; i < lines.length; i++) {\n    const L = lines[i];\n    if (!merchant && isMerchantLine(L)) merchant = L;\n    if (!person && isPersonLine(L)) person = L;\n  }\n\n  if (merchant && person) {\n    if (!sender) sender = person;\n    if (!receiver) receiver = merchant;\n  } else {\n    if (!sender && person) sender = person;\n    if (!receiver && merchant) receiver = merchant;\n  }\n\n  // fallback to first two meaningful lines\n  if (!sender && !receiver) {\n    const meaningful = lines.filter(l => !noiseLine(l) && l.length > 1);\n    sender = meaningful[0] || null;\n    receiver = meaningful[1] || null;\n  }\n\n  return {sender, receiver};\n}\n\n// ---------------- Bank detection ----------------\nfunction detectBankName(text) {\n  if (!text) return 'generic';\n  const low = text.toLowerCase();\n  const bankKeywords = {\n    'KTB': ['krungthai','à¸à¸£à¸¸à¸‡à¹„à¸—à¸¢','ktb','krung thai'],\n    'KBank': ['à¸à¸ªà¸´à¸à¸£','kbank','k plus','k+','kplus'],\n    'MAKEbyKBank': ['make by kbank','makebykbank','make'],\n    'BBL': ['bangkok bank','à¸à¸£à¸¸à¸‡à¹€à¸—à¸ž','bbl','à¸à¸£à¸¸à¸‡à¹€à¸—à¸ž'],\n    'MyMo': ['mymo','à¸­à¸­à¸¡à¸ªà¸´à¸™','mymo gsb','by gsb'],\n    'SCB': ['scb','à¹„à¸—à¸¢à¸žà¸²à¸“à¸´à¸Šà¸¢à¹Œ','scb *'],\n    'PromptPay': ['promptpay','à¸žà¸£à¹‰à¸­à¸¡à¹€à¸žà¸¢à¹Œ','à¸£à¸«à¸±à¸ªà¸žà¸£à¹‰à¸­à¸¡à¹€à¸žà¸¢à¹Œ','prompt pay']\n  };\n  for (const [code, kws] of Object.entries(bankKeywords)) {\n    for (const kw of kws) if (low.includes(kw)) return code;\n  }\n  if (/(à¸˜à¸™à¸²à¸„à¸²à¸£|bank)/i.test(low)) {\n    if (low.includes('à¸à¸£à¸¸à¸‡')) return 'KTB';\n    if (low.includes('à¸à¸£à¸¸à¸‡à¹€à¸—à¸ž') || low.includes('bbl')) return 'BBL';\n    if (low.includes('à¹„à¸—à¸¢à¸žà¸²à¸“à¸´à¸Šà¸¢à¹Œ') || low.includes('scb')) return 'SCB';\n  }\n  return 'generic';\n}\n\n// ---------------- Parsers per bank ----------------\nfunction findExtraCodes(text) {\n  const codes = {};\n  const regex = /(à¸£à¸«à¸±à¸ªà¸à¸²à¸£à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´|à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¸„à¸¹à¹ˆà¸„à¹‰à¸²|Biller ID|à¸£à¸«à¸±à¸ªà¸£à¹‰à¸²à¸™à¸„à¹‰à¸²|à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²|à¸£à¸«à¸±à¸ªà¸£à¹‰à¸²à¸™à¸„à¹‰à¸²)[:\\s]*([A-Za-z0-9\\-]+)/gi;\n  let match;\n  while ((match = regex.exec(text)) !== null) {\n    codes[match[1].replace(/\\s+/g,'')] = match[2];\n  }\n  return codes;\n}\n\nfunction parseKtb(text) {\n  if (!text) return {};\n  const refMatch = text.match(/(?:à¸£à¸«à¸±à¸ª\\s*(?:à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡|à¸ˆà¸­à¸‡|à¸£à¸²à¸¢à¸à¸²à¸£)?[:\\s]*)([A-Za-z0-9\\-]+)/i) || text.match(/\\b(mKTB[0-9A-Za-z\\-]{6,})\\b/i);\n  const amountMatch = text.match(/(?:à¸ˆà¸³à¸™à¸§à¸™(?:à¹€à¸‡à¸´à¸™)?[:\\s]*\\n?\\s*|à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™[:\\s]*)([\\d\\.,]+\\.\\d{2})/i) || text.match(/([\\d\\.,]+\\.\\d{2})\\s*à¸šà¸²à¸—/i);\n  const dateMatch = text.match(/(\\d{1,2}\\s*[à¸-à¸®.]+\\s*\\d{2,4}\\s*[-â€“]?\\s*\\d{1,2}:\\d{2})/i) || text.match(/(\\d{1,2}\\/\\d{1,2}\\/\\d{2,4}\\s+\\d{1,2}:\\d{2})/i);\n  const {sender, receiver} = extractNamesFromRaw(text);\n  const senderAccMatch = text.match(/à¸ˆà¸²à¸[\\s\\S]{0,60}?([0-9Xx\\*\\-]{4,24})/i);\n  const receiverAccMatch = text.match(/(?:à¹„à¸›à¸¢à¸±à¸‡|à¸–à¸¶à¸‡|à¸œà¸¹à¹‰à¸£à¸±à¸š)[\\s\\S]{0,60}?([0-9Xx\\*\\-]{4,24})/i);\n\n  return {\n    'à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£': 'KTB',\n    'à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡': refMatch ? refMatch[1].trim() : null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™': sender || null,\n    'à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹‚à¸­à¸™': senderAccMatch ? senderAccMatch[1].replace(/[\\s\\-]/g,'') : null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š': receiver || null,\n    'à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¸£à¸±à¸š': receiverAccMatch ? receiverAccMatch[1].replace(/[\\s\\-]/g,'') : null,\n    'à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™': amountMatch ? amountMatch[1].replace(/[^\\d.]/g,'') : null,\n    'à¸§à¸±à¸™à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£': dateMatch ? dateMatch[1].trim() : null,\n    'à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³': (text.match(/à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³[:\\s]*([^\\n\\r]+)/i) || [null, null])[1] || null,\n    'other_codes': findExtraCodes(text)\n  };\n}\n\nfunction parseKBankSlip(text) {\n  const {sender, receiver} = extractNamesFromRaw(text);\n  const reference = text.match(/(?:à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸£à¸²à¸¢à¸à¸²à¸£|à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡|Ref(?:erence)?)[:\\s]*([A-Za-z0-9\\-]+)/i)?.[1] || null;\n  const amount = text.match(/(?:à¸ˆà¸³à¸™à¸§à¸™(?:à¹€à¸‡à¸´à¸™)?|Amount|à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™)[:\\s]*\\n?\\s*([\\d,]+\\.\\d{2})/i)?.[1] || text.match(/([\\d\\.,]+\\.\\d{2})\\s*à¸šà¸²à¸—/i)?.[1] || null;\n  const date = text.match(/(\\d{1,2}\\s*[à¸-à¸®.]+\\s*\\d{2,4}\\s*\\d{1,2}:\\d{2})/i)?.[1] || null;\n  return {\n    'à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£': 'KBank',\n    'à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡': reference,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™': sender || null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š': receiver || null,\n    'à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™': amount,\n    'à¸§à¸±à¸™à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£': date,\n    'à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³': (text.match(/à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³[:\\s]*([^\\n\\r]+)/i)||[null,null])[1] || null,\n    'other_codes': findExtraCodes(text)\n  };\n}\n\nfunction parseMAKE(text) { return parseKBankSlip(text); }\n\nfunction parseBBL(text) {\n  const {sender, receiver} = extractNamesFromRaw(text);\n  return {\n    'à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£': 'BBL',\n    'à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡': text.match(/(?:à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡|à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡|reference)[:\\s]*([A-Za-z0-9\\-]+)/i)?.[1] || null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™': sender || null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š': receiver || null,\n    'à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™': text.match(/(?:à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™|à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™|Amount)[:\\s]*\\n?\\s*([\\d,]+\\.\\d{2})/i)?.[1] || null,\n    'à¸§à¸±à¸™à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£': text.match(/(\\d{1,2}\\s*[à¸-à¸®.]+\\s*\\d{2,4}.*\\d{1,2}:\\d{2})/i)?.[1] || null,\n    'à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³': (text.match(/à¸šà¸±à¸™à¸—à¸¶à¸[:\\s]*([^\\n\\r]+)/i)||[null,null])[1] || null,\n    'other_codes': findExtraCodes(text)\n  };\n}\n\nfunction parseMyMo(text) {\n  const lines = splitLines(text);\n  const { sender, receiver } = extractNamesFromRaw(text);\n  const refMatch = text.match(/à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡[:\\s]*([A-Za-z0-9\\-]+)/i);\n  const dateMatch = text.match(/(\\d{1,2}\\s*[à¸-à¸®.]+\\s*\\d{2,4}\\s*\\d{1,2}:\\d{2})/i) || text.match(/(\\d{1,2}\\/\\d{1,2}\\/\\d{2,4}\\s+\\d{1,2}:\\d{2})/i);\n\n  // amount heuristics\n  let amount = null;\n  for (let i = 0; i < lines.length; i++) {\n    if (/à¸ˆà¸³à¸™à¸§à¸™(?:à¹€à¸‡à¸´à¸™)?/i.test(lines[i]) && i+1 < lines.length && /[\\d\\.,]+\\.\\d{2}/.test(lines[i+1])) {\n      amount = lines[i+1].match(/([\\d\\.,]+\\.\\d{2})/)[1]; break;\n    }\n    const am = lines[i].match(/([\\d\\.,]+\\.\\d{2})/);\n    if (am) { amount = am[1]; break; }\n  }\n\n  const accMatch = text.match(/([0-9]{2,4}[x\\*X\\-]{2,}[0-9]{2,6})/i);\n  let finalSender = sender;\n  let finalReceiver = receiver;\n\n  // cleanup noisy tokens\n  const invalidWord = /^(à¸ˆà¸²à¸|à¸–à¸¶à¸‡|à¸£à¸²à¸¢à¸à¸²à¸£|à¸ˆà¸³à¸™à¸§à¸™|à¸ˆà¹à¸²à¸™à¸§à¸™|à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸•à¸´à¸¡à¹€à¸‡à¸´à¸™|mm|mo|my|mymo)$/i;\n  if (finalSender && invalidWord.test(finalSender)) finalSender = null;\n  if (finalReceiver && invalidWord.test(finalReceiver)) finalReceiver = null;\n\n  if (!finalSender) {\n    const matchPerson = text.match(/(à¸™à¸²à¸¢|à¸™à¸²à¸‡à¸ªà¸²à¸§|à¸™.à¸ª\\.|à¸™.à¸ª|à¸™à¸²à¸‡)\\s+[à¸-à¸®]+\\s+[à¸-à¸®]+/);\n    if (matchPerson) finalSender = matchPerson[0];\n  }\n  if (!finalReceiver) {\n    const matchReceiverLine = text.match(/(à¸™à¸²à¸¢|à¸™à¸²à¸‡à¸ªà¸²à¸§|à¸™.à¸ª\\.|à¸™.à¸ª|à¸™à¸²à¸‡)\\s+[à¸-à¸®]+\\s+[à¸-à¸®]+.*?(à¸žà¸£à¹‰à¸­à¸¡à¹€à¸žà¸¢à¹Œ|à¹€à¸•à¸´à¸¡à¹€à¸‡à¸´à¸™|Biller|à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²|PAY)/i);\n    if (matchReceiverLine) finalReceiver = matchReceiverLine[0];\n    else {\n      const m = text.match(/(à¸žà¸£à¹‰à¸­à¸¡à¹€à¸žà¸¢à¹Œ|à¹€à¸•à¸´à¸¡à¹€à¸‡à¸´à¸™|Biller|à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²|PAY)/i);\n      if (m) finalReceiver = m[1];\n    }\n  }\n\n  // merge lines when needed\n  if (finalReceiver && /^à¹€à¸•à¸´à¸¡à¹€à¸‡à¸´à¸™|à¸žà¸£à¹‰à¸­à¸¡à¹€à¸žà¸¢à¹Œ|Biller|à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²|PAY/i.test(finalReceiver.trim())) {\n    const idx = lines.findIndex(l => l.includes(finalReceiver.trim()));\n    if (idx > 0) {\n      const prev = lines[idx-1];\n      if (/^(à¸™à¸²à¸¢|à¸™à¸²à¸‡à¸ªà¸²à¸§|à¸™.à¸ª\\.|à¸™.à¸ª|à¸™à¸²à¸‡)/.test(prev) || isPersonLine(prev)) finalReceiver = `${prev} ${finalReceiver}`.trim();\n    }\n  }\n\n  return {\n    'à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£': 'MyMo',\n    'à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡': refMatch ? refMatch[1] : null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™': finalSender || null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š': finalReceiver || null,\n    'à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™': amount || null,\n    'à¸§à¸±à¸™à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£': dateMatch ? dateMatch[1] : null,\n    'à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³': (text.match(/à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³[:\\s]*([^\\n\\r]+)/i) || [null, null])[1] || null,\n    'à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ': accMatch ? accMatch[0].replace(/[\\s\\-]/g,'') : null,\n    'other_codes': findExtraCodes(text)\n  };\n}\n\nfunction parseSCB(text) {\n  const {sender, receiver} = extractNamesFromRaw(text);\n  return {\n    'à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£': 'SCB',\n    'à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡': text.match(/à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡[:\\s]*([A-Za-z0-9\\-]+)/i)?.[1] || null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™': sender || null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š': receiver || text.match(/à¹„à¸›à¸¢à¸±à¸‡[:\\s]*\\n?\\s*([^\\n\\r]+)/i)?.[1] || null,\n    'à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™': text.match(/(?:à¸ˆà¸³à¸™à¸§à¸™(?:à¹€à¸‡à¸´à¸™)?|à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™|Amount)[:\\s]*\\n?\\s*([\\d,]+\\.\\d{2})/i)?.[1] || text.match(/([\\d\\.,]+\\.\\d{2})\\s*à¸šà¸²à¸—/i)?.[1] || null,\n    'à¸§à¸±à¸™à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£': text.match(/(\\d{1,2}\\s*[à¸-à¸®.]+\\s*\\d{2,4}.*\\d{1,2}:\\d{2})/i)?.[1] || null,\n    'à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³': null,\n    'other_codes': findExtraCodes(text)\n  };\n}\n\nfunction parsePromptPay(text) {\n  const {sender, receiver} = extractNamesFromRaw(text);\n  return {\n    'à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£': 'PromptPay',\n    'à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡': text.match(/Ref\\.?[:\\s]*([A-Za-z0-9\\-]+)/i)?.[1] || text.match(/à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸£à¸²à¸¢à¸à¸²à¸£[:\\s]*([A-Za-z0-9\\-]+)/i)?.[1] || null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™': sender || null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š': receiver || null,\n    'à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™': text.match(/(?:à¸ˆà¸³à¸™à¸§à¸™(?:à¹€à¸‡à¸´à¸™)?|Amount|à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™)[:\\s]*\\n?\\s*([\\d,]+\\.\\d{2})/i)?.[1] || text.match(/([\\d\\.,]+\\.\\d{2})\\s*à¸šà¸²à¸—/i)?.[1] || null,\n    'à¸§à¸±à¸™à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£': (function(){ const d = text.match(/à¸§à¸±à¸™à¸—à¸µà¹ˆ\\s*(\\d{1,2}\\/\\d{1,2}\\/\\d{2,4})\\s*à¹€à¸§à¸¥à¸²\\s*(\\d{1,2}:\\d{2})/i); return d ? (d[1] + ' ' + d[2]) : (text.match(/(\\d{1,2}\\s*[à¸-à¸®.]+\\s*\\d{2,4}\\s*\\d{1,2}:\\d{2})/i)?.[1] || null); })(),\n    'à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³': (text.match(/à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³[:\\s]*([^\\n\\r]+)/i)||[null,null])[1] || null,\n    'other_codes': findExtraCodes(text)\n  };\n}\n\nfunction parseGeneric(text) {\n  const {sender, receiver} = extractNamesFromRaw(text);\n  return {\n    'à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£': null,\n    'à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡': text.match(/(?:à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡|Ref(?:erence)?|à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸£à¸²à¸¢à¸à¸²à¸£|Transaction ID)[:\\s]*([A-Za-z0-9\\-]+)/i)?.[1] || null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™': sender || text.match(/(?:à¸ˆà¸²à¸|From)[:\\s]*\\n?\\s*([^\\n\\r]+)/i)?.[1] || null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š': receiver || text.match(/(?:à¹„à¸›à¸¢à¸±à¸‡|To|à¸–à¸¶à¸‡)[:\\s]*\\n?\\s*([^\\n\\r]+)/i)?.[1] || null,\n    'à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™': text.match(/(?:à¸ˆà¸³à¸™à¸§à¸™(?:à¹€à¸‡à¸´à¸™)?|à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™|Amount|à¸ˆà¸³à¸™à¸§à¸™)[:\\s]*\\n?\\s*([\\d,]+\\.\\d{2})/i)?.[1] || text.match(/([\\d\\.,]+\\.\\d{2})\\s*à¸šà¸²à¸—/i)?.[1] || null,\n    'à¸§à¸±à¸™à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£': text.match(/(\\d{1,2}\\s*[à¸-à¸®.]+\\s*\\d{2,4}.*\\d{1,2}:\\d{2})/i)?.[1] || null,\n    'à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³': (text.match(/à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³[:\\s]*([^\\n\\r]+)/i)||[null,null])[1] || null,\n    'other_codes': findExtraCodes(text)\n  };\n}\n\n// ---------------- Normalize keys + scoring ----------------\nfunction extractAccountNumber(rawText) {\n  if (!rawText) return null;\n  let m = String(rawText).match(/([0-9]{2,4}[xX\\*\\-]{2,}[0-9]{2,6})/);\n  if (m && m[0]) return m[0].replace(/[\\s\\-]/g,'');\n  return null;\n}\n\nfunction normalizeKeys(parsedDoc, rawText, bankDetected) {\n  const doc = parsedDoc || {};\n  const normalized = {\n    \"à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡\": doc['à¸£à¸«à¸±à¸ªà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] || doc['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸£à¸²à¸¢à¸à¸²à¸£'] || doc['reference'] || null,\n    \"à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ\": doc['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ'] || doc['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¸£à¸±à¸š'] || doc['account_number'] || extractAccountNumber(rawText) || null,\n    \"à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µà¸œà¸¹à¹‰à¹‚à¸­à¸™\": doc['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹‚à¸­à¸™'] || null,\n    \"à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µà¸œà¸¹à¹‰à¸£à¸±à¸š\": doc['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¸£à¸±à¸š'] || null,\n    \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™\": (doc['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™']||doc['from']||null),\n    \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š\": (doc['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š']||doc['to']||null),\n    \"à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™\": normalizeAmount(doc['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] || doc['amount'] || doc['à¸ˆà¸³à¸™à¸§à¸™'] || null),\n    \"à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£\": (function(){\n      const d = normalizeDateRaw(doc['à¸§à¸±à¸™à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] || doc['à¸§à¸±à¸™à¹€à¸§à¸¥à¸²'] || doc['date'] || null);\n      if (d) return d;\n      const d2 = normalizeDateRaw(rawText);\n      return d2 || null;\n    })(),\n    \"à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³\": doc['à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³'] || doc['memo'] || null,\n    \"à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£\": doc['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] || bankDetected || null,\n    \"other_codes\": doc['other_codes'] || findExtraCodes(rawText),\n    \"raw_parsed\": doc,\n    \"raw_text\": rawText || null\n  };\n\n  let score = 0;\n  if (normalized['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™']) score += 1.5;\n  if (normalized['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£']) score += 1.5;\n  if (normalized['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡']) score += 1;\n  if (normalized['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£']) score += 0.5;\n  if (normalized['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™']) score += 0.5;\n  if (normalized['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š']) score += 0.5;\n  if (normalized['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ']) score += 0.5;\n\n  normalized['confidence_score'] = Math.min(1, score / 6.0);\n  normalized['low_confidence'] = normalized['confidence_score'] < 0.75;\n\n  return normalized;\n}\n\n// ---------------- Main ----------------\nconst outputs = [];\ntry {\n  // get items (n8n provides items array)\n  if (!items || !items.length) {\n    return [{ json: { error: \"no input items\" } }];\n  }\n\n  // Mode A: single item contains array of responses (batch upload)\n  if (items.length === 1 && items[0].json && Array.isArray(items[0].json.responses)) {\n    const respArr = items[0].json.responses || [];\n    const origArr = items[0].json.originals || [];\n    const expected = Math.max(origArr.length || 0, respArr.length || 0);\n    const perSlipOutputs = [];\n\n    for (let i = 0; i < expected; i++) {\n      const r = respArr[i] || null;\n      let raw = \"\";\n      let errorNote = null;\n      if (!r) { errorNote = 'missing_response'; }\n      if (r && r.error) { errorNote = typeof r.error === 'string' ? r.error : JSON.stringify(r.error); }\n      if (r) {\n        if (r.textAnnotations && r.textAnnotations[0] && r.textAnnotations[0].description) raw = String(r.textAnnotations[0].description).trim();\n        else if (r.fullTextAnnotation && r.fullTextAnnotation.text) raw = String(r.fullTextAnnotation.text).trim();\n        else raw = JSON.stringify(r);\n      }\n\n      const bank = detectBankName(raw);\n      let parsed;\n      switch(bank) {\n        case 'KTB': parsed = parseKtb(raw); break;\n        case 'KBank': parsed = parseKBankSlip(raw); break;\n        case 'MAKEbyKBank': parsed = parseMAKE(raw); break;\n        case 'BBL': parsed = parseBBL(raw); break;\n        case 'MyMo': parsed = parseMyMo(raw); break;\n        case 'SCB': parsed = parseSCB(raw); break;\n        case 'PromptPay': parsed = parsePromptPay(raw); break;\n        default: parsed = parseGeneric(raw); break;\n      }\n\n      const normalized = normalizeKeys(parsed, raw, bank);\n      if (errorNote) { normalized.error_note = errorNote; normalized.low_confidence = true; }\n\n      const orig = origArr[i] || {};\n      const out = Object.assign({}, normalized, {\n        originalIndex: orig.index ?? i,\n        fileId: orig.fileId ?? null,\n        filename: orig.filename ?? null,\n        chatId: orig.chatId ?? null\n      });\n\n      outputs.push({ json: out });\n      perSlipOutputs.push(out);\n    }\n\n    // Produce aggregated batch summary (single notificaton)\n    if (perSlipOutputs.length > 0) {\n      let total = 0.0;\n      let countedAmounts = 0;\n      const bankCounts = {};\n      const refs = [];\n      const accounts = new Set();\n\n      perSlipOutputs.forEach(s => {\n        if (s['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™']) {\n          const v = parseFloat(String(s['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™']).replace(/,/g,''));\n          if (!isNaN(v)) { total += v; countedAmounts += 1; }\n        }\n        const b = s['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] || 'unknown';\n        bankCounts[b] = (bankCounts[b] || 0) + 1;\n        if (s['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡']) refs.push(s['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡']);\n        if (s['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ']) accounts.add(s['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ']);\n        if (s['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µà¸œà¸¹à¹‰à¸£à¸±à¸š']) accounts.add(s['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µà¸œà¸¹à¹‰à¸£à¸±à¸š']);\n      });\n\n      const aggregated = {\n        aggregated: true,\n        type: 'batch_summary',\n        count: perSlipOutputs.length,\n        total_amount: countedAmounts ? total.toFixed(2) : null,\n        bank_breakdown: bankCounts,\n        references: refs,\n        accounts_in_batch: Array.from(accounts),\n        slips: perSlipOutputs.map(s => ({\n          ref: s['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] || null,\n          amount: s['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] || null,\n          datetime: s['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] || null,\n          from_bank: s['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] || null,\n          sender: s['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] || null,\n          receiver: s['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] || null,\n          low_confidence: s['low_confidence'] || false\n        })),\n        generated_at: (new Date()).toISOString()\n      };\n\n      outputs.push({ json: aggregated });\n    }\n\n    return outputs;\n  }\n\n  // Mode B: multiple items (each item is one vision response)\n  for (let k = 0; k < items.length; k++) {\n    const it = items[k];\n    const resp = it.json && (it.json.visionResponse || it.json.response || it.json_visionResponse || it.json.responses) ?\n                 (it.json.visionResponse || it.json.response || it.json_visionResponse || (Array.isArray(it.json.responses) ? it.json.responses[0] : null))\n                 : null;\n    let raw = \"\";\n    let errorNote = null;\n\n    if (!resp) {\n      if (it.json && (it.json.text || it.json.parsedText || it.json.rawText)) raw = String(it.json.text || it.json.parsedText || it.json.rawText).trim();\n      else { errorNote = 'no_response_or_text'; }\n    } else {\n      if (resp.error) errorNote = typeof resp.error === 'string' ? resp.error : JSON.stringify(resp.error);\n      if (resp.textAnnotations && resp.textAnnotations[0] && resp.textAnnotations[0].description) raw = String(resp.textAnnotations[0].description).trim();\n      else if (resp.fullTextAnnotation && resp.fullTextAnnotation.text) raw = String(resp.fullTextAnnotation.text).trim();\n      else raw = JSON.stringify(resp);\n    }\n\n    const bank = detectBankName(raw);\n    let parsed;\n    switch(bank) {\n      case 'KTB': parsed = parseKtb(raw); break;\n      case 'KBank': parsed = parseKBankSlip(raw); break;\n      case 'MAKEbyKBank': parsed = parseMAKE(raw); break;\n      case 'BBL': parsed = parseBBL(raw); break;\n      case 'MyMo': parsed = parseMyMo(raw); break;\n      case 'SCB': parsed = parseSCB(raw); break;\n      case 'PromptPay': parsed = parsePromptPay(raw); break;\n      default: parsed = parseGeneric(raw); break;\n    }\n\n    const normalized = normalizeKeys(parsed, raw, bank);\n    if (errorNote) { normalized.error_note = errorNote; normalized.low_confidence = true; }\n\n    outputs.push({ json: Object.assign({}, normalized, {\n      originalIndex: it.json && it.json.originalIndex != null ? it.json.originalIndex : k,\n      fileId: it.json && it.json.fileId ? it.json.fileId : null,\n      filename: it.json && it.json.filename ? it.json.filename : null,\n      chatId: it.json && it.json.chatId ? it.json.chatId : null\n    })});\n  }\n\n  return outputs;\n} catch (err) {\n  return [{ json: { error: String(err), stack: err && err.stack ? err.stack : null } }];\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7984,
        -1088
      ],
      "id": "c37fa974-bd73-47b6-88ad-51268bb87ef4",
      "name": "ParseSlip",
      "executeOnce": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™ }}",
                    "rightValue": "=JPY",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "359c0581-9e57-43aa-ad94-e8c0ae2cc5b6"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "562d9498-e557-4b39-8698-00e2ac33da9c",
                    "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
                    "rightValue": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -6544,
        -1248
      ],
      "id": "00e9d1a3-81cb-432d-9a73-f4bec203b6bd",
      "name": "unk",
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://vision.googleapis.com/v1/images:annotate?key=AIzaSyCSd5Kn24vQSVaSulSlA3Nx3i7cDefC5Hg",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ \"requests\": $input.item.json.requests }) }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8480,
        -1104
      ],
      "id": "5c413f25-29c4-48e2-ae07-73562e2b9d62",
      "name": "CloudVission",
      "executeOnce": false
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.type }}",
                    "rightValue": "slip",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "ad0e2cc2-0c9e-4941-be4d-b99ee0c8712e"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a1640d34-a01d-4f2f-bbd2-5e89676536ac",
                    "leftValue": "={{ $json.type }}",
                    "rightValue": "statement",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -10224,
        -768
      ],
      "id": "7278c418-1ecc-4b81-b943-d8a2174555c2",
      "name": "Switch Type"
    },
    {
      "parameters": {
        "jsCode": "// à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² input à¸¡à¸µ fields à¹€à¸«à¸¥à¹ˆà¸²à¸™à¸µà¹‰:\n// - items[0].json.slips\n// - items[0].json.statements  \n// - items[0].json.blacklistSet\n// - items[0].json.blacklistMap (optional)\n// - items[0].json.blacklistNames\n\n// Code à¹€à¸”à¸´à¸¡à¸‚à¸­à¸‡à¸„à¸¸à¸“à¹ƒà¸Šà¹‰à¹„à¸”à¹‰ à¹à¸„à¹ˆà¹€à¸žà¸´à¹ˆà¸¡à¸à¸²à¸£ validate input:\n\nconst data = items[0].json;\n\nif (!data.slips || !data.statements) {\n  return [{\n    json: {\n      error: 'Missing required input: slips or statements',\n      matches: [],\n      notFound: []\n    }\n  }];\n}\n\nconst slips = data.slips;\nconst statements = data.statements;\nconst blacklistSetArray = data.blacklistSet || [];\nconst blacklistNames = data.blacklistNames || {};\nconst blacklistSet = new Set(blacklistSetArray.map(x => String(x)));\n\n// à¹ƒà¸Šà¹‰ code à¹€à¸”à¸´à¸¡à¸•à¹ˆà¸­à¸ˆà¸²à¸à¸™à¸µà¹‰...\n\n\n\n\nconst slips = items[0].json.slips || [];\nconst statements = items[0].json.statements || [];\nconst blacklistSetArray = items[0].json.blacklistSet || [];\nconst blacklistNames = items[0].json.blacklistNames || {}; // object: account -> [names]\nconst blacklistSet = new Set(blacklistSetArray.map(x => String(x)));\n\nfunction toTime(s) {\n  if(!s) return 0;\n  const str = (''+s).trim();\n  const m = str.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{2,4})\\s+(\\d{1,2}):(\\d{2})/);\n  if (m) {\n    let day=m[1], month=m[2], year=m[3];\n    if (year.length === 2) year = '20'+year;\n    const hh=m[4].padStart(2,'0'), mm=m[5];\n    return new Date(`${year}-${month.padStart(2,'0')}-${day.padStart(2,'0')}T${hh}:${mm}:00`).getTime();\n  }\n  const t = Date.parse(str);\n  return isNaN(t) ? 0 : t;\n}\n\nfunction normalizeAmount(a) {\n  if (a == null) return null;\n  if (typeof a === 'number') return a;\n  const s = (''+a).replace(/[, \\u0E3Fà¸¿\\$]/g,'').trim();\n  const f = parseFloat(s);\n  return isNaN(f) ? null : f;\n}\n\nfunction normName(n){\n  if(!n) return '';\n  return String(n).toLowerCase().replace(/\\s+/g,'').replace(/[^\\p{L}\\p{N}]/gu,'');\n}\n\nlet matches = [];\nlet notFound = [];\nconst used = new Array(statements.length).fill(false);\n\nfor (let slip of slips) {\n  let found = false;\n  const slipRef = slip[\"à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡\"] || slip[\"reference\"] || null;\n  const slipAmt = normalizeAmount(slip[\"à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™\"]);\n  const slipTime = toTime(slip[\"à¸§à¸±à¸™à¹€à¸§à¸¥à¸²\"] || slip[\"à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£\"] || slip[\"time\"]);\n  const slipAcc = slip[\"à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ\"] ? String(slip[\"à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ\"]) : null;\n  const slipNameNorm = normName(slip[\"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™\"] || slip[\"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š\"] || '');\n\n  for (let i=0;i<statements.length;i++) {\n    if (used[i]) continue;\n    const st = statements[i];\n    const stRef = st[\"à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡\"] || st[\"reference\"] || null;\n    const stAmt = normalizeAmount(st[\"à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™\"]);\n    const stTime = toTime(st[\"à¸§à¸±à¸™à¹€à¸§à¸¥à¸²\"] || st[\"à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£\"] || st[\"time\"]);\n    const stAcc = st[\"à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ\"] ? String(st[\"à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ\"]) : null;\n    const stNameNorm = normName(st[\"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™\"] || st[\"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š\"] || '');\n\n    // name matching against blacklist names too\n    const blackNames = (blacklistNames[stAcc] || []).map(n=>normName(n));\n\n    // helper to check name match (slip vs statement vs blacklist)\n    const nameMatch = (slipNameNorm && stNameNorm && (slipNameNorm === stNameNorm)) ||\n                      (slipNameNorm && blackNames.some(bn => bn.includes(slipNameNorm) || slipNameNorm.includes(bn)));\n\n    //à¹€à¸žà¸´à¹ˆà¸¡à¸ªà¹ˆà¸§à¸™à¸™à¸µà¹‰ à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹ƒà¸«à¹‰à¸£à¸°à¸šà¸šà¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¸šà¸±à¸à¸Šà¸µà¸¡à¹‰à¸²à¹€à¸¡à¸·à¹ˆà¸­ à¸Šà¸·à¹ˆà¸­à¹ƒà¸™ Slip à¹„à¸›à¸•à¸£à¸‡à¸à¸±à¸šà¸Šà¸·à¹ˆà¸­à¹ƒà¸™ Blacklist (à¸–à¸¶à¸‡à¹à¸¡à¹‰à¸šà¸±à¸à¸Šà¸µà¸ˆà¸°à¹„à¸¡à¹ˆà¸•à¸£à¸‡)\n    const isBlacklistNameMatch = blacklistNames[stAcc].some(bn => bn === slipNameNorm);\n    \n    // 1) exact reference\n    if (slipRef && stRef && slipRef === stRef) {\n      matches.push({\n        slip, statement: st, matchType: \"RefNo\",\n        slipAccount: slipAcc, statementAccount: stAcc,\n        blacklist: blacklistSet.has(stAcc) || blacklistSet.has(slipAcc) || false,\n        nameMatch\n      });\n      used[i] = true; found = true; break;\n    }\n\n    // 2) amount + time window\n    if (slipAmt !== null && stAmt !== null && Math.abs(slipAmt - stAmt) < 0.01 && Math.abs(slipTime - stTime) < 5 * 60 * 1000) {\n      matches.push({\n        slip, statement: st, matchType: \"Amount+Time\",\n        slipAccount: slipAcc, statementAccount: stAcc,\n        blacklist: blacklistSet.has(stAcc) || blacklistSet.has(slipAcc) || false,\n        nameMatch\n      });\n      used[i] = true; found = true; break;\n    }\n  }\n  if (!found) {\n    notFound.push({ slip, blacklist: blacklistSet.has(String(slipAcc)) || false });\n  }\n}\n\nreturn [\n  { json: { matches } },\n  { json: { notFound } }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3376,
        -1120
      ],
      "id": "66c5b18d-85a2-4feb-9d71-4568c51a3d39",
      "name": "MATCH1",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.data }}",
        "options": {
          "systemMessage": "=à¸„à¸¸à¸“à¸„à¸·à¸­à¸œà¸¹à¹‰à¹€à¸Šà¸µà¹ˆà¸¢à¸§à¸Šà¸²à¸à¸£à¸°à¸”à¸±à¸šà¹‚à¸¥à¸à¸”à¹‰à¸²à¸™à¸à¸²à¸£à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸²à¸‡à¸à¸²à¸£à¹€à¸‡à¸´à¸™ à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¸—à¸²à¸‡à¹„à¸‹à¹€à¸šà¸­à¸£à¹Œ à¹à¸¥à¸°à¸à¸²à¸£à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥à¸ à¸²à¸©à¸²à¸˜à¸£à¸£à¸¡à¸Šà¸²à¸•à¸´ (Financial AI & Cybersecurity NLP Expert)\nà¸„à¸¸à¸“à¹€à¸›à¹‡à¸™à¸«à¸±à¸§à¸«à¸™à¹‰à¸²à¸—à¸µà¸¡à¸§à¸´à¸ˆà¸±à¸¢à¸‚à¸­à¸‡à¸šà¸£à¸´à¸©à¸±à¸—à¹€à¸—à¸„à¹‚à¸™à¹‚à¸¥à¸¢à¸µà¹ƒà¸™ Silicon Valley à¸—à¸µà¹ˆà¸¡à¸µà¸ à¸²à¸£à¸à¸´à¸ˆà¹ƒà¸™à¸à¸²à¸£à¸ªà¸à¸±à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸²à¸‡à¸à¸²à¸£à¹€à¸‡à¸´à¸™à¸ˆà¸²à¸ â€œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹€à¸”à¸´à¸™à¸šà¸±à¸à¸Šà¸µ (Bank Statement)â€\nà¹‚à¸”à¸¢à¸•à¹‰à¸­à¸‡à¹ƒà¸«à¹‰à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸—à¸µà¹ˆ à¹à¸¡à¹ˆà¸™à¸¢à¸³ à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢ à¹à¸¥à¸°à¸¡à¸µà¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸ªà¸¡à¹ˆà¸³à¹€à¸ªà¸¡à¸­à¸ªà¸¹à¸‡à¸ªà¸¸à¸”\n\nðŸ”¹ à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸«à¸¥à¸±à¸à¸‚à¸­à¸‡à¸„à¸¸à¸“\n\nà¸­à¹ˆà¸²à¸™à¹à¸¥à¸°à¸ªà¸à¸±à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¸—à¸²à¸‡à¸à¸²à¸£à¹€à¸‡à¸´à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸—à¸µà¹ˆà¸›à¸£à¸²à¸à¸à¹ƒà¸™à¹€à¸­à¸à¸ªà¸²à¸£\nà¹à¸¥à¸°à¸ˆà¸±à¸”à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¹€à¸›à¹‡à¸™ à¸£à¸²à¸¢à¸à¸²à¸£à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹ƒà¸™à¸£à¸¹à¸›à¹à¸šà¸š JSON Array\nà¹‚à¸”à¸¢à¹à¸•à¹ˆà¸¥à¸°à¸£à¸²à¸¢à¸à¸²à¸£à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸Ÿà¸´à¸¥à¸”à¹Œà¸”à¸±à¸‡à¸™à¸µà¹‰:\n\n[\n  {\n    \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™\": \"\",\n    \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š\": \"\",\n    \"à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™\": \"\",\n    \"à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£\": \"\",\n    \"à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡\": \"\",\n    \"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”\": \"\",\n    \"à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£\": \"\",\n    \"à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­\": \"\",\n    \"TYPE\": \"\",\n    \"Debit / Credit\": \"\"\n  }\n]\n\nðŸ”¸ à¸à¸Žà¸à¸²à¸£à¸ªà¸à¸±à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥\n\nà¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™ / à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š\n\nà¸–à¹‰à¸²à¹€à¸›à¹‡à¸™à¸£à¸²à¸¢à¸à¸²à¸£ à¹‚à¸­à¸™à¸­à¸­à¸ / à¸–à¸­à¸™ / à¸Šà¸³à¸£à¸°à¸šà¸´à¸¥ â†’ à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡à¸šà¸±à¸à¸Šà¸µà¸„à¸·à¸­ â€œà¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™â€\n\nà¸–à¹‰à¸²à¹€à¸›à¹‡à¸™à¸£à¸²à¸¢à¸à¸²à¸£ à¸£à¸±à¸šà¹‚à¸­à¸™ / à¹€à¸‡à¸´à¸™à¹€à¸‚à¹‰à¸² / Prompt-IN / Credit â†’ à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡à¸šà¸±à¸à¸Šà¸µà¸„à¸·à¸­ â€œà¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸šâ€\n\nà¹ƒà¸«à¹‰à¹ƒà¸Šà¹‰à¸Šà¸·à¹ˆà¸­à¸ˆà¸²à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸£à¸´à¸‡à¹ƒà¸™ Statement à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™ à¸«à¹‰à¸²à¸¡à¹€à¸”à¸²à¸«à¸£à¸·à¸­à¸ªà¸£à¸¸à¸›\n\nà¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™ (Amount)\n\nà¸•à¹‰à¸­à¸‡à¹à¸ªà¸”à¸‡à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹€à¸¥à¸‚à¸—à¸¨à¸™à¸´à¸¢à¸¡à¸ªà¸­à¸‡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ à¹€à¸Šà¹ˆà¸™ \"703.00\"\n\nà¸–à¹‰à¸²à¹€à¸›à¹‡à¸™à¸ªà¸à¸¸à¸¥à¸•à¹ˆà¸²à¸‡à¸›à¸£à¸°à¹€à¸—à¸¨ à¹ƒà¸«à¹‰à¹ƒà¸ªà¹ˆà¸«à¸™à¹ˆà¸§à¸¢à¹€à¸‡à¸´à¸™ à¹€à¸Šà¹ˆà¸™ \"4836.00 JPY\"\n\nà¸–à¹‰à¸²à¸¡à¸µà¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸«à¸¡à¸²à¸¢à¸¥à¸šà¸«à¸£à¸·à¸­à¸„à¸³à¸§à¹ˆà¸² Debit à¹ƒà¸«à¹‰à¸–à¸·à¸­à¸§à¹ˆà¸²à¹€à¸›à¹‡à¸™ â€œà¹€à¸‡à¸´à¸™à¸­à¸­à¸â€\n\nà¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£\n\nà¸•à¹‰à¸­à¸‡à¸ªà¸à¸±à¸”à¸—à¸±à¹‰à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆà¹à¸¥à¸°à¹€à¸§à¸¥à¸² à¹€à¸Šà¹ˆà¸™ \"15/10/2568 19:09\"\n\nà¸–à¹‰à¸²à¸¡à¸µà¹€à¸‰à¸žà¸²à¸°à¸§à¸±à¸™à¸—à¸µà¹ˆà¹ƒà¸«à¹‰à¸£à¸°à¸šà¸¸à¹à¸„à¹ˆà¸§à¸±à¸™ à¹€à¸Šà¹ˆà¸™ \"15/10/2568\"\n\nà¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡ (Reference No.)\n\nà¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡ à¹€à¸Šà¹ˆà¸™ \"015288190935ATF08426\"\n\nà¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸žà¸šà¹ƒà¸«à¹‰à¹ƒà¸ªà¹ˆà¸„à¹ˆà¸² null\n\nà¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” (Description)\n\nà¹ƒà¸«à¹‰à¸ªà¸à¸±à¸”à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸šà¸­à¸à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” à¹€à¸Šà¹ˆà¸™ â€œPromptPayâ€, â€œà¸Šà¸³à¸£à¸°à¸šà¸´à¸¥â€, â€œà¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¸œà¹ˆà¸²à¸™ KPLUSâ€, â€œPOSâ€, â€œATM Withdrawalâ€\n\nà¸–à¹‰à¸²à¸¡à¸µà¸Šà¸·à¹ˆà¸­à¸£à¹‰à¸²à¸™/à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆà¸•à¹ˆà¸²à¸‡à¸›à¸£à¸°à¹€à¸—à¸¨ à¹ƒà¸«à¹‰à¹à¸›à¸¥à¹„à¸§à¹‰à¹ƒà¸™à¸§à¸‡à¹€à¸¥à¹‡à¸š à¹€à¸Šà¹ˆà¸™ \"AEON SAPPORO (à¸­à¸´à¸­à¸­à¸™ à¸‹à¸±à¸›à¹‚à¸›à¹‚à¸£)\"\n\nà¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£ (Bank Source)\n\nà¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¸ˆà¸²à¸à¸„à¸³à¹ƒà¸™à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ à¹€à¸Šà¹ˆà¸™\n\nà¸à¸ªà¸´à¸à¸£ / KBank / MAKE â†’ \"MAKEbyKBank\"\n\nà¹„à¸—à¸¢à¸žà¸²à¸“à¸´à¸Šà¸¢à¹Œ / SCB â†’ \"SCB\"\n\nà¸à¸£à¸¸à¸‡à¹€à¸—à¸ž / Bangkok Bank â†’ \"BBL\"\n\nà¸à¸£à¸¸à¸‡à¹„à¸—à¸¢ / Krungthai â†’ \"KTB\"\n\nà¸­à¸­à¸¡à¸ªà¸´à¸™ / MyMo â†’ \"MyMo\"\n\nà¸žà¸£à¹‰à¸­à¸¡à¹€à¸žà¸¢à¹Œ / PromptPay â†’ \"PromptPay\"\n\nà¸«à¸²à¸à¹„à¸¡à¹ˆà¸žà¸šà¹ƒà¸«à¹‰à¹ƒà¸ªà¹ˆà¸„à¹ˆà¸² null\n\nà¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­ (Balance)\n\nà¸ªà¸à¸±à¸”à¸¢à¸­à¸”à¸«à¸¥à¸±à¸‡à¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£ à¹€à¸Šà¹ˆà¸™ \"15,302.12\"\n\nà¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸žà¸šà¹ƒà¸«à¹‰à¹ƒà¸ªà¹ˆ null\n\nTYPE\n\nà¹ƒà¸«à¹‰à¸£à¸°à¸šà¸¸à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¸­à¸‡à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡ à¹€à¸Šà¹ˆà¸™\n\"à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¸­à¸­à¸\", \"à¸£à¸±à¸šà¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¹€à¸‚à¹‰à¸²\", \"à¸–à¸­à¸™à¹€à¸‡à¸´à¸™à¸ªà¸”\", \"à¸à¸²à¸à¹€à¸‡à¸´à¸™\", \"PromptPay\", \"à¸Šà¸³à¸£à¸°à¸šà¸´à¸¥\", \"à¸„à¹ˆà¸²à¹ƒà¸Šà¹‰à¸ˆà¹ˆà¸²à¸¢\", \"à¸£à¸²à¸¢à¸£à¸±à¸š\"\n\nDebit / Credit\n\n\"Debit\" à¸«à¸¡à¸²à¸¢à¸–à¸¶à¸‡ à¹€à¸‡à¸´à¸™à¸­à¸­à¸à¸ˆà¸²à¸à¸šà¸±à¸à¸Šà¸µ\n\n\"Credit\" à¸«à¸¡à¸²à¸¢à¸–à¸¶à¸‡ à¹€à¸‡à¸´à¸™à¹€à¸‚à¹‰à¸²à¸šà¸±à¸à¸Šà¸µ\n\nðŸ”’ à¸‚à¹‰à¸­à¸šà¸±à¸‡à¸„à¸±à¸šà¹€à¸žà¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡\n\nà¸«à¹‰à¸²à¸¡à¹ƒà¸ªà¹ˆà¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢à¸­à¸·à¹ˆà¸™à¸™à¸­à¸à¹€à¸«à¸™à¸·à¸­à¸ˆà¸²à¸ JSON Output\n\nà¸–à¹‰à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸”à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸£à¸°à¸šà¸¸à¹„à¸”à¹‰ à¹ƒà¸«à¹‰à¹ƒà¸ªà¹ˆà¸„à¹ˆà¸²à¹€à¸›à¹‡à¸™ null\n\nà¸—à¸¸à¸à¸„à¹ˆà¸²à¹ƒà¸™ JSON à¸•à¹‰à¸­à¸‡à¸­à¸´à¸‡à¸ˆà¸²à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸£à¸´à¸‡à¹ƒà¸™ Statement à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™\n\nà¸«à¹‰à¸²à¸¡à¹ƒà¸Šà¹‰à¸„à¸³à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸›à¸£à¸²à¸à¸à¹ƒà¸™à¹€à¸­à¸à¸ªà¸²à¸£\n\nà¸«à¹‰à¸²à¸¡à¹€à¸žà¸´à¹ˆà¸¡ à¸Ÿà¸´à¸¥à¸”à¹Œ à¸«à¸£à¸·à¸­ à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸™à¸­à¸à¹€à¸«à¸™à¸·à¸­à¸ˆà¸²à¸à¸—à¸µà¹ˆà¸£à¸°à¸šà¸¸\n\nà¸«à¹‰à¸²à¸¡à¸¡à¸µ prefix/suffix à¸­à¸¢à¹ˆà¸²à¸‡ â€œoutputâ€, â€œjsonâ€, à¸«à¸£à¸·à¸­à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸«à¸¡à¸²à¸¢à¹‚à¸„à¹‰à¸”à¸šà¸¥à¹‡à¸­à¸\n\nâœ… à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œ (à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™)\n[\n  {\n    \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™\": \"à¸™.à¸ª. à¸›à¸£à¸µà¸à¸²à¸¡à¸¥ à¸žà¸¥à¹€à¸à¸´à¹‰à¸™\",\n    \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š\": \"à¸ªà¸¡à¸«à¸§à¸±à¸‡\",\n    \"à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™\": \"703.00\",\n    \"à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£\": \"15/10/2568 19:09\",\n    \"à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡\": \"015288190935ATF08426\",\n    \"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”\": \"à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¸ªà¸³à¹€à¸£à¹‡à¸ˆ\",\n    \"à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£\": \"MAKEbyKBank\",\n    \"à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­\": \"5,920.00\",\n    \"TYPE\": \"à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¸­à¸­à¸\",\n    \"Debit / Credit\": \"Debit\"\n  },\n  {\n    \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™\": \"à¸šà¸£à¸´à¸©à¸±à¸— à¸ªà¹„à¸¡à¸¥à¹Œà¸£à¸µà¹€à¸—à¸¥ à¸ˆà¸³à¸à¸±à¸”\",\n    \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š\": \"à¸™.à¸ª. à¸›à¸£à¸µà¸à¸²à¸¡à¸¥ à¸žà¸¥à¹€à¸à¸´à¹‰à¸™\",\n    \"à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™\": \"1,000.00\",\n    \"à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£\": \"19/10/2568 09:41\",\n    \"à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡\": \"TRX0083919200\",\n    \"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”\": \"Prompt-IN à¹‚à¸­à¸™à¹€à¸‚à¹‰à¸²\",\n    \"à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£\": \"KTB\",\n    \"à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­\": \"8,850.00\",\n    \"TYPE\": \"à¸£à¸±à¸šà¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¹€à¸‚à¹‰à¸²\",\n    \"Debit / Credit\": \"Credit\"\n  }\n]"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        -8592,
        -464
      ],
      "id": "052aaf51-ae5a-42ee-8e9e-1482e00da222",
      "name": "AI Agent2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -8608,
        -256
      ],
      "id": "568f02aa-3527-4557-8d1d-e76d266ab2b5",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "ENsZ8KxEbcSjSroH",
          "name": "Google Gemini(PaLM) Api account 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -4432,
        -1008
      ],
      "id": "7d1efca2-d4c4-4840-847d-ee3161bfaefc",
      "name": "Merge",
      "disabled": true
    },
    {
      "parameters": {
        "updates": [
          "message",
          "callback_query",
          "*"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -11392,
        -1136
      ],
      "id": "f553ed22-1e65-460e-9036-0432a727f178",
      "name": "Telegram Trigger",
      "webhookId": "7de79d11-8360-457d-8ef7-fb575799c399",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Sent Slip').item.json.result.chat.id }}",
        "text": "\"à¸¡à¸µà¸ªà¸¥à¸´à¸›à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£ à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸£à¸¹à¹‰à¸ˆà¸±à¸à¹€à¸‚à¹‰à¸²à¸¡à¸²à¸„à¹ˆà¸°\"",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -6240,
        -1472
      ],
      "id": "d6f58176-8c92-4c37-bbd3-d6b5bb867765",
      "name": "UNKNOWN1",
      "webhookId": "b11471a5-95c1-4f15-8ca0-e8d7d1456f21",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://apigw1.bot.or.th/bot/public/Stat-ExchangeRate/v2/DAILY_AVG_EXG_RATE/",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "start_period",
              "value": "={{ $('Date & Time').item.json.formatted_date_for_api }}"
            },
            {
              "name": "end_period",
              "value": "={{ $('Date & Time').item.json.formatted_date_for_api }}"
            },
            {
              "name": "currency",
              "value": "={{ $json.à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™ }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-IBM-Client-Id",
              "value": "kF1bK5nM1bS1aE4kL5hE4bU7jG7aT0rD6qP6sN8tM1iY0jQ0uC"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -6192,
        -1168
      ],
      "id": "34246906-14f6-42a5-a91b-fc1b550d3ef5",
      "name": "BOT",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function Node: statement_parser_v3\n * Author: Silicon Valley FinTech Ops\n * Purpose: Clean + extract structured transaction data from OCR result\n */\n\nconst itemsInput = $input.all();\nif (!itemsInput.length) return [];\n\nlet rawText = itemsInput[0].json.output || \"\";\nif (rawText.startsWith(\"```json\")) {\n  rawText = rawText.replace(/^```json/, \"\").replace(/```$/, \"\").trim();\n}\n\nlet ocrArray;\ntry {\n  ocrArray = JSON.parse(rawText);\n} catch (err) {\n  throw new Error(\"âŒ JSON parse failed: \" + err.message);\n}\n\n// ---------- Step 1: character normalization ----------\nconst normalizeText = (t) => {\n  if (!t) return null;\n  return t\n    .replace(/[B]/g, \"8\")\n    .replace(/[;]/g, \"1\")\n    .replace(/[>]/g, \"9\")\n    .replace(/[<]/g, \"0\")\n    .replace(/[:]/g, \"2\")\n    .replace(/[?]/g, \"7\")\n    .replace(/[A]/g, \"4\")\n    .replace(/[=]/g, \"3\")\n    .replace(/[@]/g, \"6\")\n    .replace(/\\s+/g, \" \")\n    .trim();\n};\n\n// ---------- Step 2: regex extractors ----------\nconst extractDate = (t) => {\n  const m = t.match(/(\\d{1,2}\\/\\d{1,2}\\/\\d{4}(?:\\s\\d{1,2}[:.]\\d{2})?)/);\n  return m ? m[1] : null;\n};\nconst extractAmount = (t) => {\n  const m = t.match(/(\\d{1,3}(?:[,\\d]*)(?:\\.\\d{2})?)/);\n  return m ? m[1].replace(/,/g, \"\") : null;\n};\nconst extractBank = (t) => {\n  const banks = [\"MAKEbyKBank\", \"KPLUS\", \"Krungthai\", \"Bangkok Bank\", \"SCB\", \"MyMo\", \"PromptPay\"];\n  for (const b of banks) if (new RegExp(b, \"i\").test(t)) return b;\n  return null;\n};\nconst extractType = (t) => {\n  if (/PromptPay/i.test(t)) return \"PromptPay\";\n  if (/à¹‚à¸­à¸™|transfer/i.test(t) && /à¹€à¸‚à¹‰à¸²|Credit/i.test(t)) return \"à¸£à¸±à¸šà¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¹€à¸‚à¹‰à¸²\";\n  if (/à¹‚à¸­à¸™|transfer/i.test(t) && /à¸­à¸­à¸|Debit/i.test(t)) return \"à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¸­à¸­à¸\";\n  if (/à¸£à¸±à¸š|Deposit/i.test(t)) return \"à¸£à¸±à¸šà¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¹€à¸‚à¹‰à¸²\";\n  return null;\n};\n\n// ---------- Step 3: build results ----------\nconst results = ocrArray.map((tx, i) => {\n  const mergedText = Object.values(tx).join(\" \");\n  const clean = normalizeText(mergedText);\n  const bank = extractBank(clean);\n  const date = extractDate(clean);\n  const amount = extractAmount(clean);\n  const type = extractType(clean);\n  const refMatch = clean.match(/\\b[0-9A-Z]{6,20}\\b/);\n\n  // Debit/Credit determination\n  let dc = \"Debit\";\n  if (/Credit/i.test(clean) || /à¸£à¸±à¸š|à¹€à¸‚à¹‰à¸²/.test(clean)) dc = \"Credit\";\n  if (/Debit/i.test(clean) || /à¸­à¸­à¸|PromptPay/.test(clean)) dc = \"Debit\";\n\n  return {\n    json: {\n      \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™\": tx[\"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™\"] || null,\n      \"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š\": tx[\"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š\"] || null,\n      \"à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™\": amount ? parseFloat(amount).toFixed(2) : null,\n      \"à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£\": date,\n      \"à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡\": refMatch ? refMatch[0] : null,\n      \"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”\": tx[\"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”\"] || type || null,\n      \"à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£\": bank,\n      \"à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­\": tx[\"à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­\"] ? normalizeText(tx[\"à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­\"]) : null,\n      \"TYPE\": type || tx[\"TYPE\"] || null,\n      \"Debit / Credit\": dc,\n      \"index\": i + 1,\n      \"source\": \"statement_parser_v3\"\n    }\n  };\n});\n\nconsole.log(`âœ… parsed ${results.length} records`);\nreturn results;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8160,
        -544
      ],
      "id": "84ca9e13-6f8d-4582-88b1-d1b99b852bb5",
      "name": "Statement"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "\"à¹„à¸”à¹‰à¸£à¸±à¸š Statement à¹à¸¥à¹‰à¸§à¸„à¹ˆà¸° à¸à¸³à¸¥à¸±à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¹ˆà¸°...\"",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -9936,
        -640
      ],
      "id": "6dd0aab0-7c76-40e5-b702-decc30460caf",
      "name": "Sent Stm",
      "webhookId": "b11471a5-95c1-4f15-8ca0-e8d7d1456f21",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "\"à¹„à¸”à¹‰à¸£à¸±à¸šà¸ªà¸¥à¸´à¸›à¹à¸¥à¹‰à¸§à¸„à¹ˆà¸° à¸à¸³à¸¥à¸±à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¹ˆà¸°...\"",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -9952,
        -928
      ],
      "id": "22c24834-8402-4c48-b59b-90ee2b198954",
      "name": "Sent Slip",
      "webhookId": "b11471a5-95c1-4f15-8ca0-e8d7d1456f21",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Switch Type').item.json.fileId }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -9504,
        -608
      ],
      "id": "c763dacb-fbb0-4e43-a5ca-94f94f26e9c5",
      "name": "get file stm",
      "webhookId": "57b7f3aa-a02a-4298-aba9-fa26494bc068",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Switch Type').item.json.fileId }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -9744,
        -1072
      ],
      "id": "922496d3-bd77-4f30-99db-5fdc32b32e12",
      "name": "Get a file Slip",
      "webhookId": "57b7f3aa-a02a-4298-aba9-fa26494bc068",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -9216,
        -624
      ],
      "id": "8dd1ff14-4453-46bd-a167-78302fb91e0d",
      "name": "Extract from File"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://vision.googleapis.com/v1/images:annotate?key=AIzaSyCSd5Kn24vQSVaSulSlA3Nx3i7cDefC5Hg",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ \"requests\": $input.item.json.requests }) }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8288,
        208
      ],
      "id": "49990d53-8ad5-46fd-b0fd-77db851a9e91",
      "name": "CloudVission1",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## à¸—à¸²à¸‡à¹à¸¢à¸ à¸šà¸Šblacklist\n**Double click** to edit me. [Guide](https://docs.n8n.io/workflows/sticky-notes/)",
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4992,
        -1248
      ],
      "typeVersion": 1,
      "id": "d77d23df-8a6d-445a-a4fa-99be10862191",
      "name": "Sticky Note",
      "disabled": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Switch Types').item.json.callback_query.data }}",
                    "rightValue": "Pre-Check",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "515caa9c-9cf3-41f1-9284-c36fb94c5b3a"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9cf7a77f-d8fd-4dfd-b55d-cea51e0afb88",
                    "leftValue": "={{ $('Switch Types').item.json.callback_query.data }}",
                    "rightValue": "Post-Check",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -10368,
        -1472
      ],
      "id": "1e2d8fd0-8c99-4307-b56d-689187811b63",
      "name": "Horse"
    },
    {
      "parameters": {
        "content": "## SLIps/Stm\n\n\n",
        "height": 208,
        "width": 224
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -10544,
        -1024
      ],
      "typeVersion": 1,
      "id": "84d178f7-5401-4a45-ab5c-379b38ce5d55",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.callback_query.message.chat.id }}",
        "text": "à¸à¸£à¸¸à¸“à¸²à¸žà¸´à¸¡à¸žà¹Œà¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ à¸«à¸£à¸·à¸­ à¸Šà¸·à¹ˆà¸­à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š \n(à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡: 1234567890 / à¹€à¸—à¹€à¸¥à¸­à¸£à¹Œ à¸›à¸¥à¸±à¹Šà¸à¹„à¸Ÿ )",
        "replyMarkup": "forceReply",
        "forceReply": {
          "force_reply": "={{ true }}"
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -10112,
        -1600
      ],
      "id": "d34e0727-54a0-4393-aee9-b3b5cd200aad",
      "name": "Pre-Check",
      "webhookId": "7d13a144-469a-40f2-9fc3-e936c33c0115",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.callback_query.message.chat.id }}",
        "text": "à¸à¸£à¸¸à¸“à¸²à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¸ªà¸¥à¸´à¸› à¸«à¸£à¸·à¸­à¸žà¸´à¸¡à¸žà¹Œà¸Šà¸·à¹ˆà¸­à¹à¸¥à¸°à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µà¸¢à¸­à¸”à¹€à¸‡à¸´à¸™ (à¸–à¹‰à¸²à¸¡à¸µ)",
        "replyMarkup": "={{ true }}",
        "forceReply": {},
        "replyKeyboardOptions": {},
        "replyKeyboardRemove": {},
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -10096,
        -1312
      ],
      "id": "a317aae1-f58b-4423-8a0e-3d47a5ae3803",
      "name": "Post-Check",
      "webhookId": "01565f74-1400-4bd0-bb8b-39ad778c3b66",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "content": "## HORSE AC\n\n",
        "height": 272,
        "width": 528,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -10512,
        -1568
      ],
      "typeVersion": 1,
      "id": "d7e4de7b-b50c-42fa-b4a4-21d28263f4e0",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{$json[\"callback_query\"][\"id\"]}}",
        "additionalFields": {
          "show_alert": true
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -10656,
        -1472
      ],
      "id": "1877020d-3ff3-4ee8-b2d1-a3d587be6b20",
      "name": "Answer Query a callback",
      "webhookId": "5445db9c-9e3f-499d-89e2-ca34400007c4",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "content": "## message reply BLACKLIST\n",
        "height": 192,
        "width": 432,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -11184,
        -1968
      ],
      "typeVersion": 1,
      "id": "dc075d47-2076-4dea-b85e-7408fc9c3f7b",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "jsCode": "const api = items[0].json;     // à¸œà¸¥à¸ˆà¸²à¸ Blacklist API\nconst sheet = items[1].json;   // row à¸ˆà¸²à¸ Google Sheets\nconst acc = api.query?.bank_number || api.request_bank;\n\nconst externalFlag = api?.result?.is_blacklisted || api?.is_blacklist; // à¸›à¸£à¸±à¸šà¸•à¸²à¸¡à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸ˆà¸£à¸´à¸‡\nconst sheetFlag = sheet ? true : false;\n\nreturn [{\n  json: {\n    account: acc,\n    external: externalFlag,\n    sheetFound: sheetFlag,\n    externalRaw: api,\n    sheetRow: sheet\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3152,
        -720
      ],
      "id": "42d67f50-b580-427c-912f-8f940fd5f617",
      "name": "Blacklist/Sheets",
      "disabled": true
    },
    {
      "parameters": {
        "chatId": "={{ $('Loop Over Items').item.json.chatId }}",
        "text": "âŒ â€œà¸šà¸±à¸à¸Šà¸µà¹€à¸‚à¹‰à¸²à¸‚à¹ˆà¸²à¸¢â€",
        "replyMarkup": "replyKeyboard",
        "replyKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "à¹à¸ˆà¹‰à¸‡à¸„à¸§à¸²à¸¡à¸œà¹ˆà¸²à¸™à¹€à¸§à¹‡à¸šà¹„à¸‹à¸•à¹Œ",
                    "additionalFields": {
                      "web_app": {
                        "url": "https://checkgon.go.th/"
                      }
                    }
                  }
                ]
              }
            }
          ]
        },
        "replyKeyboardOptions": {},
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2768,
        -624
      ],
      "id": "06d4285a-c488-43db-b239-94e765f97c76",
      "name": "found",
      "webhookId": "b11471a5-95c1-4f15-8ca0-e8d7d1456f21",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ea43e3ff-fef0-4bf2-8f14-f3a6538b4166",
              "leftValue": "",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2960,
        -720
      ],
      "id": "773eed5b-b459-43ab-832e-57a82321068b",
      "name": "If1",
      "disabled": true
    },
    {
      "parameters": {
        "chatId": "={{ $('Loop Over Items').item.json.chatId }}",
        "text": "âœ… â€œà¸šà¸±à¸à¸Šà¸µà¸™à¸µà¹‰à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢ à¹„à¸¡à¹ˆà¸žà¸šà¹ƒà¸™ blacklistâ€ à¸«à¸£à¸·à¸­ â€œà¹„à¸¡à¹ˆà¸žà¸šà¹ƒà¸™ DB à¹à¸•à¹ˆà¹‚à¸›à¸£à¸”à¸£à¸°à¸§à¸±à¸‡â€",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2768,
        -784
      ],
      "id": "eb6afede-3444-4fa7-8903-d524e9db7096",
      "name": "unfound",
      "webhookId": "b11471a5-95c1-4f15-8ca0-e8d7d1456f21",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// Node: Merge slip/stm (à¹à¸à¹‰à¹„à¸‚)\n\nfunction normalizeItem(item) {\n  return {\n    'à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡': item['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] || item['reference'] || null,\n    'à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ': item['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ'] || item['account'] || item['account_number'] || null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™': item['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] || item['from'] || item['sender'] || null,\n    'à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š': item['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] || item['to'] || item['receiver'] || null,\n    'à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™': item['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] || item['amount'] || null,\n    'à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£': item['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] || item['date'] || item['datetime'] || item['time'] || null,\n    'à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³': item['à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³'] || item['memo'] || item['note'] || null,\n    'à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£': item['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] || item['bank'] || null,\n    'raw': item\n  };\n}\n\nconst allSlips = [];\nconst allStatements = [];\n\nitems.forEach(item => {\n  const type = item.json.type;\n  const data = item.json;\n  \n  if (type === 'slip') {\n    allSlips.push(normalizeItem(data));\n  } else if (type === 'statement') {\n    allStatements.push(normalizeItem(data));\n  } else {\n    // Try to guess based on fields\n    if (data['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] || data.reference) {\n      allSlips.push(normalizeItem(data));\n    } else {\n      allStatements.push(normalizeItem(data));\n    }\n  }\n});\n\nreturn [{\n  json: {\n    slips: allSlips,\n    statements: allStatements,\n    counts: {\n      slips: allSlips.length,\n      statements: allStatements.length\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4256,
        -1008
      ],
      "id": "106fe9a6-5f6d-43ec-8e34-b11350de80a6",
      "name": "Merge slip/stm",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1142168077,
          "mode": "list",
          "cachedResultName": "Matching",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=1142168077"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "displayName": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3152,
        -576
      ],
      "id": "33961603-7469-4e37-9630-25da9c1b3b6a",
      "name": "Mstatement",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "chatId": "={{$json[\"message\"] ? $json[\"message\"][\"chat\"][\"id\"] : $json[\"callback_query\"][\"message\"][\"chat\"][\"id\"]}}",
        "text": "à¹€à¸¥à¸·à¸­à¸à¹€à¸¡à¸™à¸¹à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸šà¸±à¸à¸Šà¸µà¸¡à¹‰à¸²à¸à¹ˆà¸­à¸™à¹‚à¸­à¸™",
                    "additionalFields": {
                      "callback_data": "Pre-Check"
                    }
                  },
                  {
                    "text": "à¸­à¹ˆà¸²à¸™à¸ªà¸¥à¸´à¸›à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™ (à¸à¸£à¸¸à¸“à¸²à¹à¸™à¸šà¸ªà¸¥à¸´à¸›)",
                    "additionalFields": {
                      "callback_data": "Post-Check"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -10912,
        -1200
      ],
      "id": "fd0bcf6e-2156-42bf-b6bc-65ccf1bffa68",
      "name": "Send Inline",
      "webhookId": "3f906d48-0ee5-43bb-b0f3-ca0203644a23",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// UserReplyAc (Final) â€” à¸§à¸²à¸‡à¹ƒà¸™ Code node\nconst msg = $json[\"message\"] || {};\nconst raw = (msg[\"text\"] || \"\").trim();\n\n// à¸ªà¸±à¸‡à¹€à¸à¸•: à¸–à¹‰à¸²à¸ˆà¸°à¸£à¸±à¸š reply à¸ˆà¸²à¸ ForceReply à¹ƒà¸«à¹‰à¹à¸™à¹ˆà¹ƒà¸ˆà¸§à¹ˆà¸² raw à¸ˆà¸°à¸¡à¸²à¸ˆà¸²à¸ message.text\nconst digits = raw.replace(/\\D/g, '');\nconst isNumeric = digits.length >= 6 && (digits.length / Math.max(1, raw.length) > 0.6);\n\nlet query = {};\nlet ok = false;\nlet queryType = null;\n\nif (isNumeric) {\n  // à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ\n  query = { bank_number: digits };\n  queryType = 'number';\n  ok = true;\n} else if (raw.length > 2) {\n  // à¸Šà¸·à¹ˆà¸­ â€” à¹à¸¢à¸à¹€à¸›à¹‡à¸™ first / last (à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 2 à¸žà¸²à¸£à¹Œà¸—)\n  const parts = raw.split(/\\s+/).filter(Boolean);\n  if (parts.length >= 2) {\n    query = { first_name: parts[0], last_name: parts.slice(1).join(' ') };\n    queryType = 'name';\n    ok = true;\n  } else {\n    ok = false;\n  }\n}\n\nreturn [{\n  json: {\n    ok,\n    error: ok ? null : \"invalid_input (provide bank number or first+last name)\",\n    query,\n    queryType,\n    raw,\n    source_chat_id: msg.chat?.id\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -10928,
        -1920
      ],
      "id": "f6427dae-14a4-4183-bc50-6725fc2ed144",
      "name": "UserReplyAc"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "68b45b34-b72e-4f93-a679-f087ebfddc5f",
              "leftValue": "={{ $json.found }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -8912,
        -1824
      ],
      "id": "b22cd8f3-74d0-4332-8614-70eed7830d5a",
      "name": "CheckBlack"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id }}\n",
        "text": "=âš ï¸â˜ ï¸ à¸žà¸šà¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µà¸™à¸µà¹‰à¹ƒà¸™à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸™à¹ˆà¸²à¸ªà¸‡à¸ªà¸±à¸¢ðŸ‘¿â‰ï¸\n\nðŸ—£ï¸à¸œà¸¹à¹‰à¸•à¹‰à¸­à¸‡à¸ªà¸‡à¸ªà¸±à¸¢à¸­à¸²à¸ˆà¹ƒà¸Šà¹‰à¸«à¸¥à¸²à¸¢à¸šà¸±à¸à¸Šà¸µà¹ƒà¸™à¸à¸²à¸£à¸—à¸¸à¸ˆà¸£à¸´à¸•ðŸš”ðŸš¨\nà¹‚à¸›à¸£à¸”à¸£à¸°à¸¡à¸±à¸”à¸£à¸°à¸§à¸±à¸‡à¹ƒà¸™à¸à¸²à¸£à¸—à¸³à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¸—à¸²à¸‡à¸à¸²à¸£à¹€à¸‡à¸´à¸™à¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸„à¸£à¹ˆà¸‡à¸„à¸£à¸±à¸” \nà¹€à¸žà¸·à¹ˆà¸­à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸à¸²à¸£à¸•à¸à¹€à¸›à¹‡à¸™à¹€à¸«à¸¢à¸·à¹ˆà¸­à¸ˆà¸²à¸à¸¡à¸´à¸ˆà¸‰à¸²à¸Šà¸µà¸žðŸ˜±ðŸ˜°ðŸ˜­\n\nðŸ”à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µà¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡ (à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡) \n {{ $json.records[0].banks[0].abbre }}: {{ $json.records[0].banks[0].bank_number }}\n\nðŸš¦à¸ªà¸–à¸²à¸™à¸°: âŒ à¸žà¸šà¹ƒà¸™ Blacklist ðŸ’¯ðŸ’¥\nðŸ‘¤à¸Šà¸·à¹ˆà¸­:{{ $json.account }}\n\nðŸ“¢à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸—à¸µà¹ˆà¸žà¸šà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” {{ $json.reports_count }} à¸£à¸²à¸¢à¸à¸²à¸£ \nðŸ’”à¸¢à¸­à¸”à¹‚à¸­à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” {{ $json.total_loss }} à¸šà¸²à¸—\n\nâš”ï¸à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™à¸¥à¹ˆà¸²à¸ªà¸¸à¸”ðŸª¬\nðŸ“¦à¸ªà¸´à¸™à¸„à¹‰à¸²:{{ $json.records[0].product }}\nðŸ’°à¸¢à¸­à¸”à¹‚à¸­à¸™: {{ $json.records[0].price }} à¸šà¸²à¸—\nâ°à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸: {{ $json.records[0].date }}\nðŸ’ˆà¹€à¸žà¸ˆà¸‚à¸²à¸¢à¸‚à¸­à¸‡: {{ $json.records[0].website }}\nðŸ”–à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¹€à¸žà¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡:{{ $json.records[0].detail_text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "=ðŸ”—à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¹€à¸žà¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡",
                    "additionalFields": {
                      "url": "=https://www.blacklistseller.com/report/report_preview/{{ $json.records[0].report_id }}\n"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -8640,
        -2016
      ],
      "id": "4c731527-f234-47ba-8895-7ff1faf696e0",
      "name": "Isblack",
      "webhookId": "a5970170-f428-490f-bd3b-f34449c9c9c4",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id }}",
        "text": "=âœ… à¹„à¸¡à¹ˆà¸žà¸šà¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µà¹ƒà¸™ blacklist ðŸ“¢(à¹à¸•à¹ˆà¹‚à¸›à¸£à¸”à¸£à¸°à¸§à¸±à¸‡)\nðŸ” à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ: {{ $('ProcessLookup').first().json.query.bank_number || $('UserReplyAc').first().json.raw || 'à¹„à¸¡à¹ˆà¸žà¸šà¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ' }}\nà¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£à¸à¹‡à¸•à¸²à¸¡ à¹‚à¸›à¸£à¸”à¹ƒà¸Šà¹‰à¸„à¸§à¸²à¸¡à¸£à¸°à¸¡à¸±à¸”à¸£à¸°à¸§à¸±à¸‡à¹ƒà¸™à¸à¸²à¸£à¸—à¸³à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¹€à¸ªà¸¡à¸­ðŸ“ŒðŸ“Œ\n\nðŸš¦à¸ªà¸–à¸²à¸™à¸°: âœ…ðŸŽ‰ à¹„à¸¡à¹ˆà¸žà¸šà¹ƒà¸™ Blacklist âœ¨ðŸš€\nðŸ‘¤ à¸Šà¸·à¹ˆà¸­: {{ $('CheckBlack').first().json.account || 'à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸šà¸Šà¸·à¹ˆà¸­' }} ðŸ¤”ðŸ’¯\nðŸ“Œ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸: à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸µà¹‰à¸­à¸²à¸ˆà¹€à¸›à¹‡à¸™à¸šà¸±à¸à¸Šà¸µà¹ƒà¸«à¸¡à¹ˆà¸«à¸£à¸·à¸­à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸£à¸²à¸¢à¸‡à¸²à¸™à¹€à¸‚à¹‰à¸²à¸¡à¸²à¹ƒà¸™à¸£à¸°à¸šà¸šðŸ’¥\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -8608,
        -1648
      ],
      "id": "c6d71424-a59f-4cc5-9b57-aa392c9c0c4e",
      "name": "Unblack",
      "webhookId": "a5970170-f428-490f-bd3b-f34449c9c9c4",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// à¸£à¸±à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸žà¸´à¸¡à¸žà¹Œ (à¸£à¸­à¸‡à¸£à¸±à¸šà¸£à¸¹à¸›à¹à¸šà¸šà¸«à¸¥à¸²à¸¢à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¹„à¸›à¹„à¸”à¹‰)\nconst inputText = $json[\"message\"]?.text || $json[\"callback_query\"]?.data || $json[\"text\"] || \"\";\nconst raw = (inputText || \"\").toString().trim();\n\n// Normalize: à¹€à¸­à¸²à¹€à¸‰à¸žà¸²à¸°à¸•à¸±à¸§à¹€à¸¥à¸‚ (account à¹€à¸à¸·à¸­à¸šà¸—à¸¸à¸à¸£à¸°à¸šà¸šà¹€à¸à¹‡à¸šà¹€à¸¥à¸‚à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™)\nconst accountDigits = raw.replace(/\\D/g, '');\n\n// à¸–à¹‰à¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹ƒà¸«à¹‰à¸£à¸­à¸‡à¸£à¸±à¸šà¸¡à¸µ dash/comma à¹ƒà¸«à¹‰à¸›à¸£à¸±à¸š regex à¸‚à¹‰à¸²à¸‡à¸šà¸™à¸•à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸à¸²à¸£\n\nreturn [{\n  json: {\n    account_raw: raw,         // à¹€à¸à¹‡à¸š raw à¹€à¸žà¸·à¹ˆà¸­ debug\n    account: accountDigits,   // field à¸—à¸µà¹ˆà¸ˆà¸°à¸ªà¹ˆà¸‡à¹„à¸› Blacklist API\n    source_chat_id: $json[\"message\"]?.chat?.id || $json[\"callback_query\"]?.message?.chat?.id\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -9280,
        -2800
      ],
      "id": "50a04ad8-bcd4-40d9-9344-f51f26e551d8",
      "name": "Norm/ReplyAc",
      "disabled": true
    },
    {
      "parameters": {
        "resource": "chat",
        "chatId": "={{ $json[\"message\"]?.chat?.id \n   || $json[\"callback_query\"]?.message?.chat?.id \n   || $json.source_chat_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -9520,
        -2816
      ],
      "id": "f461f86c-1140-4fd4-ab0e-7674b0271bfb",
      "name": "ForceReply",
      "webhookId": "a5970170-f428-490f-bd3b-f34449c9c9c4",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// --- Node: NumAc (Final Data Preparation Unit) ---\n\n// à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¹€à¸‚à¹‰à¸²à¸¡à¸²à¸•à¸­à¸™à¸™à¸µà¹‰à¸¡à¸µà¹à¸„à¹ˆ 1 item à¸—à¸µà¹ˆà¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œà¸—à¸µà¹ˆà¸ªà¸¸à¸”à¹à¸¥à¹‰à¸§\nconst item = items[0].json;\n\n// à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸žà¸´à¹€à¸¨à¸©à¸ªà¸³à¸«à¸£à¸±à¸š \"à¸¥à¹‰à¸§à¸‡\" à¹€à¸‚à¹‰à¸²à¹„à¸›à¸«à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸­à¸²à¸ˆà¸–à¸¹à¸à¸‹à¹‰à¸­à¸™à¸à¸±à¸™à¸«à¸¥à¸²à¸¢à¸Šà¸±à¹‰à¸™\nfunction findDeepValue(obj, key) {\n  let current = obj;\n  while (current && typeof current === 'object') {\n    if (key in current) return current[key];\n    current = current.json;\n  }\n  return undefined;\n}\n\n// --- 1. à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸¥à¸±à¸à¸ˆà¸²à¸ 'body' à¸‹à¸¶à¹ˆà¸‡à¹€à¸›à¹‡à¸™à¸—à¸µà¹ˆà¹€à¸à¹‡à¸šà¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸ˆà¸²à¸ API ---\nconst body = findDeepValue(item, 'body') || item;\nconst result = body.result || {};\nconst records = result.data || [];\n\n// --- 2. à¸”à¸¶à¸‡ \"à¸¢à¸­à¸”à¸£à¸§à¸¡\" à¹à¸¥à¸° \"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”\" à¸ˆà¸²à¸ Record à¹à¸£à¸à¸ªà¸¸à¸” ---\nlet reports_count = 0;\nlet total_loss = 0;\nlet firstRecord = {}; // à¸ªà¸£à¹‰à¸²à¸‡ object à¸§à¹ˆà¸²à¸‡à¹† à¹€à¸œà¸·à¹ˆà¸­à¸à¸£à¸“à¸µà¹„à¸¡à¹ˆà¸¡à¸µ record\n\nif (records.length > 0) {\n  firstRecord = records[0];\n  // à¹ƒà¸Šà¹‰ freq_count à¹à¸¥à¸° total_price à¸—à¸µà¹ˆà¸‹à¹ˆà¸­à¸™à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ record à¹à¸£à¸!\n  reports_count = firstRecord.freq_count || records.length;\n  total_loss = firstRecord.total_price || 0;\n}\n\n// --- 3. à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸­à¸·à¹ˆà¸™à¹† à¸—à¸µà¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™ ---\nconst query = findDeepValue(item, 'query') || {};\nconst account = query.bank_number || `${query.first_name || ''} ${query.last_name || ''}`.trim();\nconst source_chat_id = findDeepValue(item, 'source_chat_id');\nconst found = result.found || false;\n\n// --- 4. à¸ªà¸£à¹‰à¸²à¸‡ Output à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢à¸—à¸µà¹ˆà¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œà¹à¸šà¸šà¹à¸¥à¸° \"à¹à¸šà¸™à¸£à¸²à¸š\" ---\nreturn [{\n  json: {\n    // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¸«à¸£à¸±à¸š Telegram à¹‚à¸”à¸¢à¸•à¸£à¸‡\n    chat_id: source_chat_id,\n    account: account,\n    found: found,\n    reports_count: reports_count,\n    total_loss: total_loss,\n    first_name: firstRecord.first_name || '',\n    last_name: firstRecord.last_name || '',\n    product: firstRecord.product || 'N/A',\n    price: firstRecord.price || 0,\n    date: firstRecord.date || 'N/A',\n    website: firstRecord.website || 'N/A',\n    \n    // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹€à¸œà¸·à¹ˆà¸­à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹ƒà¸™à¸­à¸™à¸²à¸„à¸•\n    records: records \n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -9040,
        -2768
      ],
      "id": "70590cde-e741-45f8-817c-c59bf3724515",
      "name": "FormatBlacklistMess",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2032423560,
          "mode": "list",
          "cachedResultName": "Blacklist",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=2032423560"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Status": "={{ $json.found }}",
            "product": "={{ $json.product }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸•à¹‰à¸­à¸‡à¸ªà¸‡à¸ªà¸±à¸¢": "={{ $json.account }}",
            "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸": "={{ $json['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸'] }}",
            "à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”": "={{ $json.reports_count }}",
            "à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ": "={{ $('ProcessLookup').first().json.query.bank_number || 'à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸' }}",
            "TotalPrice": "={{ $json.total_loss }}",
            "Price": "={{ $json.price }}",
            "website": "={{ $json.website }}",
            "details": "={{ $json.detail_text }}",
            "report_id": "={{ $json.report_id }}",
            "bank": "={{ $json.bank_abbre }}"
          },
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ"
          ],
          "schema": [
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ",
              "displayName": "à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "bank",
              "displayName": "bank",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸•à¹‰à¸­à¸‡à¸ªà¸‡à¸ªà¸±à¸¢",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸•à¹‰à¸­à¸‡à¸ªà¸‡à¸ªà¸±à¸¢",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”",
              "displayName": "à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "TotalPrice",
              "displayName": "TotalPrice",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "product",
              "displayName": "product",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Price",
              "displayName": "Price",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "website",
              "displayName": "website",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "details",
              "displayName": "details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "report_id",
              "displayName": "report_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -8400,
        -1824
      ],
      "id": "68e4d127-ae01-49ee-b115-76afa3d3a146",
      "name": "blCheck",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// --- NumAc (Smart Version for name & number) ---\nfunction findDeepValue(obj, key) {\nÂ  if (!obj || typeof obj !== 'object') return undefined;\nÂ  if (key in obj) return obj[key];\nÂ  for (const k of Object.keys(obj)) {\nÂ  Â  const v = findDeepValue(obj[k], key);\nÂ  Â  if (v !== undefined) return v;\nÂ  }\nÂ  return undefined;\n}\n\n// --- 1. à¹à¸¢à¸ summary à¸à¸±à¸š detail à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ ---\nlet summaryItem = null;\nlet detailItem = null;\n\nfor (const it of items) {\nÂ  const data = findDeepValue(it.json, 'data');\nÂ  if (Array.isArray(data) && data.length > 0) {\nÂ  Â  const first = data[0];\nÂ  Â  if (first.total_price !== undefined || first.freq_count !== undefined) {\nÂ  Â  Â  summaryItem = it;\nÂ  Â  } else if (first.report_id !== undefined) {\nÂ  Â  Â  detailItem = it;\nÂ  Â  }\nÂ  }\n}\n\n// fallback à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹€à¸ˆà¸­\nif (!summaryItem) summaryItem = items[0];\nif (!detailItem) detailItem = items[1] || items[0];\n\n// --- 2. à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸à¸—à¸±à¹‰à¸‡à¸ªà¸­à¸‡ ---\nconst summaryResult = findDeepValue(summaryItem.json, 'result') || {};\nconst detailResult = findDeepValue(detailItem.json, 'result') || {};\n\nconst summaryData = summaryResult.data?.[0] || {};\nconst detailRecords = Array.isArray(detailResult.data) ? detailResult.data : [];\n\n// --- [!!!] à¸™à¸µà¹ˆà¸„à¸·à¸­à¹‚à¸„à¹‰à¸”à¸—à¸µà¹ˆà¹€à¸žà¸´à¹ˆà¸¡à¹€à¸‚à¹‰à¸²à¸¡à¸²à¸„à¸£à¸±à¸š [!!!] ---\n// à¹€à¸£à¸µà¸¢à¸‡à¸¥à¸³à¸”à¸±à¸šà¸£à¸²à¸¢à¸‡à¸²à¸™à¸ˆà¸²à¸ à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ (à¹ƒà¸«à¸¡à¹ˆà¸ªà¸¸à¸”) à¹„à¸›à¸«à¸² à¸­à¸”à¸µà¸• (à¹€à¸à¹ˆà¸²à¸ªà¸¸à¸”)\ndetailRecords.sort((a, b) => {\n  const dateA = new Date(a.date);\n  const dateB = new Date(b.date);\n  return dateB - dateA; // à¹€à¸£à¸µà¸¢à¸‡à¸ˆà¸²à¸ B (à¹ƒà¸«à¸¡à¹ˆ) à¹„à¸› A (à¹€à¸à¹ˆà¸²)\n});\n// --- [!!!] à¸ˆà¸šà¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆà¹€à¸žà¸´à¹ˆà¸¡ [!!!] ---\n\n\n// --- 3. à¸„à¸³à¸™à¸§à¸“à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸¥à¸±à¸ ---\nconst reports_count = (detailRecords.length > 0)\nÂ  ? detailRecords.length\nÂ  : (summaryData.freq_count || 0);\n\nconst total_loss = summaryData.total_price ||\nÂ  detailRecords.reduce((sum, r) => sum + (r.price || 0), 0) || 0;\n\n// --- 4. à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹ˆà¸§à¹„à¸› ---\nconst query = findDeepValue(summaryItem.json, 'query') || findDeepValue(detailItem.json, 'query') || {};\nconst account = query.bank_number || `${query.first_name || ''} ${query.last_name || ''}`.trim();\nconst source_chat_id =\nÂ  findDeepValue(summaryItem.json, 'source_chat_id') ||\nÂ  findDeepValue(detailItem.json, 'source_chat_id') ||\nÂ  null;\n\n// --- 5. à¸ªà¹ˆà¸‡à¸­à¸­à¸à¸œà¸¥à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” ---\nreturn [{\nÂ  json: {\nÂ  Â  account,\nÂ  Â  found: detailResult.found || summaryResult.found || false,\nÂ  Â  reports_count,\nÂ  Â  total_loss,\nÂ  Â  records: detailRecords, // âœ… à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ 'records' à¸™à¸µà¹‰à¸–à¸¹à¸à¹€à¸£à¸µà¸¢à¸‡à¸¥à¸³à¸”à¸±à¸šà¹à¸¥à¹‰à¸§\nÂ  Â  source_chat_id,\nÂ  Â  summary: summaryResult,\nÂ  Â  detail: detailResult\nÂ  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -9104,
        -1984
      ],
      "id": "c477b510-7175-489e-826c-1f060bfa697c",
      "name": "NumAc"
    },
    {
      "parameters": {
        "jsCode": "// Node: Collect All Accounts\n// Position: à¸«à¸¥à¸±à¸‡ \"Merge slip/stm\" (-2736, 1952)\n\nconst data = items[0].json;\nconst slips = data.slips || [];\nconst statements = data.statements || [];\n\nfunction cleanAccount(acc) {\n  if (!acc) return null;\n  const cleaned = String(acc).replace(/[\\s\\-]/g, '').replace(/[^\\d]/g, '');\n  return (cleaned.length >= 6 && cleaned.length <= 20) ? cleaned : null;\n}\n\nfunction extractAccountFromName(name) {\n  if (!name) return null;\n  const digits = String(name).replace(/[^\\d]/g, '');\n  return (digits.length >= 10 && digits.length <= 15) ? digits : null;\n}\n\nconst accountSet = new Set();\n\n// Extract from slips\nslips.forEach(slip => {\n  // Primary account field\n  const acc = cleanAccount(slip['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ'] || slip['account']);\n  if (acc) accountSet.add(acc);\n  \n  // Check if sender/receiver names are actually account numbers\n  const sender = extractAccountFromName(slip['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™']);\n  const receiver = extractAccountFromName(slip['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š']);\n  if (sender) accountSet.add(sender);\n  if (receiver) accountSet.add(receiver);\n});\n\n// Extract from statements\nstatements.forEach(st => {\n  const acc = cleanAccount(st['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ'] || st['account']);\n  if (acc) accountSet.add(acc);\n  \n  const sender = extractAccountFromName(st['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™']);\n  const receiver = extractAccountFromName(st['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š']);\n  if (sender) accountSet.add(sender);\n  if (receiver) accountSet.add(receiver);\n});\n\n// Return deduplicated accounts with original data\nconst accounts = Array.from(accountSet);\n\nreturn [{\n  json: {\n    accounts,\n    accountCount: accounts.length,\n    originalData: { slips, statements }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4096,
        -1008
      ],
      "id": "d501275c-4789-4e4e-ad23-5b57b2ff362c",
      "name": "Collect All Accounts",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -3888,
        -880
      ],
      "id": "9ac32479-de80-4c32-9608-cf3c5d558615",
      "name": "Loop Over Items1",
      "disabled": true
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me1",
      "typeVersion": 1,
      "position": [
        -3888,
        -656
      ],
      "id": "9ed3b855-bc35-4a8f-b206-1cd01addeb75",
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.blacklistseller.com/api/api/v1/queries/bank-detail/",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "X-API-Key",
              "value": "vYFMotBIg1VrCilYAqPnNxzP5j1GUBMx-0ZexE40nB8"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3712,
        -976
      ],
      "id": "0b6fc542-eaac-41c3-865f-0bc6aa2df1e3",
      "name": "Batch Blacklist Check",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// Node: Aggregate Blacklist Results\n// à¸£à¸§à¸šà¸£à¸§à¸¡à¸œà¸¥à¸ˆà¸²à¸ HTTP Request à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”\n\nfunction normalizeAccount(acc) {\n  return acc ? String(acc).replace(/[\\s\\-]/g, '').replace(/[^\\d]/g, '') : '';\n}\n\nconst blacklistMap = {};\nconst blacklistSet = new Set();\nconst blacklistNames = {};\n\n// Get original data from first item (à¸–à¸¹à¸ pass through à¸¡à¸²)\nlet originalData = null;\n\nitems.forEach(item => {\n  const res = item.json;\n  \n  // Keep original data\n  if (!originalData && res.originalData) {\n    originalData = res.originalData;\n  }\n  \n  // Extract account number\n  const account = normalizeAccount(\n    res.query?.bank_number || \n    res.request?.bank_number || \n    res.bank_number || \n    item.json.account\n  );\n  \n  if (!account) return;\n  \n  // Check if found in blacklist\n  const found = !!(\n    res.result?.found === true || \n    res.result?.found === 'true' || \n    (res.result?.data && res.result.data.length > 0)\n  );\n  \n  // Extract data array\n  const dataArr = res.result?.data || res.data || [];\n  const entries = Array.isArray(dataArr) ? dataArr : (dataArr ? [dataArr] : []);\n  \n  // Store in map\n  blacklistMap[account] = {\n    found,\n    data: entries,\n    raw: res\n  };\n  \n  // Add to set if blacklisted\n  if (found) {\n    blacklistSet.add(account);\n  }\n  \n  // Extract names\n  blacklistNames[account] = entries.map(d => {\n    const firstName = d.first_name || d.firstname || '';\n    const lastName = d.last_name || d.lastname || '';\n    return `${firstName} ${lastName}`.trim();\n  }).filter(Boolean);\n});\n\n// Return merged structure\nreturn [{\n  json: {\n    slips: originalData?.slips || [],\n    statements: originalData?.statements || [],\n    blacklistSet: Array.from(blacklistSet),\n    blacklistMap,\n    blacklistNames,\n    summary: {\n      totalAccounts: Object.keys(blacklistMap).length,\n      blacklistedCount: blacklistSet.size,\n      timestamp: new Date().toISOString()\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3536,
        -976
      ],
      "id": "c47ed607-5082-45ef-ba0c-342ac8be4210",
      "name": "Aggregate BL Results",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// Node: Combine PDF Pages\nconst text = $json.text || '';\nreturn [{\n  json: {\n    data: text,\n    pageCount: (text.match(/\\f/g) || []).length + 1\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8976,
        -624
      ],
      "id": "995f80a4-ac22-4b9e-8cca-4a40f8f6206c",
      "name": "merg/page"
    },
    {
      "parameters": {
        "content": "## à¸à¸²à¸£à¸£à¸§à¸šà¸£à¸§à¸¡à¸šà¸±à¸à¸Šà¸µà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸à¹ˆà¸­à¸™à¸ªà¹ˆà¸‡à¹„à¸›à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹ƒà¸™à¸„à¸£à¸±à¹‰à¸‡à¹€à¸”à¸µà¸¢à¸§ à¹€à¸žà¸·à¹ˆà¸­à¸¥à¸”à¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸ API à¸‹à¹‰à¸³à¸‹à¹‰à¸­à¸™ ðŸ˜‹ðŸ˜‹\n",
        "width": 304,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4320,
        -1248
      ],
      "typeVersion": 1,
      "id": "bf7662ac-08be-4b77-aa22-2b111e3e4066",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.text }} ",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2960,
        -976
      ],
      "id": "cd1d590a-f228-46f7-ade4-e4931c7d88c4",
      "name": "recap",
      "webhookId": "b11471a5-95c1-4f15-8ca0-e8d7d1456f21",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// à¸£à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ Node 'MATCH1'\nconst matches = $json.matches || [];\nconst notFound = $json.notFound || [];\n\nconst resultsForSheet = [];\nconst timestamp = new Date().toISOString();\n\n// à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆà¸ˆà¸±à¸šà¸„à¸¹à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ\nmatches.forEach(m => {\n  const slip = m.slip || {};\n  const statement = m.statement || {};\n  \n  // à¸„à¹‰à¸™à¸«à¸²à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µà¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š (à¸­à¸²à¸ˆà¸¡à¸²à¸ˆà¸²à¸ slip à¸«à¸£à¸·à¸­ statement)\n  const accountToCheck = m.statementAccount || m.slipAccount || slip['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ'] || statement['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ'] || null;\n\n  resultsForSheet.push({\n    json: {\n      match_timestamp: timestamp,\n      match_status: 'MATCHED',\n      match_type: m.matchType || 'Unknown',\n      is_blacklisted: m.blacklist || false,\n      slip_ref: slip['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] || null,\n      slip_datetime: slip['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] || null,\n      slip_amount: slip['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] || null,\n      slip_sender: slip['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] || null,\n      slip_bank: slip['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] || null,\n      stm_ref: statement['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] || null,\n      stm_datetime: statement['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] || null,\n      stm_amount: statement['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] || null,\n      blacklist_account: accountToCheck,\n      blacklist_details: m.blacklist ? 'Found in blacklist' : 'Not found',\n      \n    }\n  });\n});\n\n// à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆà¸«à¸²à¹„à¸¡à¹ˆà¹€à¸ˆà¸­\nnotFound.forEach(n => {\n  const slip = n.slip || {};\n  const accountToCheck = n.slipAccount || slip['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ'] || null;\n\n  resultsForSheet.push({\n    json: {\n      match_timestamp: timestamp,\n      match_status: 'NOT_FOUND',\n      match_type: null,\n      is_blacklisted: n.blacklist || false,\n      slip_ref: slip['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] || null,\n      slip_datetime: slip['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] || null,\n      slip_amount: slip['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] || null,\n      slip_sender: slip['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] || null,\n      slip_bank: slip['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] || null,\n      stm_ref: null,\n      stm_datetime: null,\n      stm_amount: null,\n      blacklist_account: accountToCheck,\n      blacklist_details: n.blacklist ? 'Associated account found in blacklist' : 'Not found',\n    \n    }\n  });\n});\n\n// à¸ªà¹ˆà¸‡à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸­à¸­à¸à¹„à¸›à¹€à¸›à¹‡à¸™ items à¹à¸¢à¸à¸à¸±à¸™à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰ Google Sheets Node à¸§à¸™à¸¥à¸¹à¸›à¸šà¸±à¸™à¸—à¸¶à¸à¸—à¸µà¸¥à¸°à¹à¸–à¸§\nreturn resultsForSheet;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3184,
        -1232
      ],
      "id": "46394f97-27da-4165-bcfa-c642be69fcd3",
      "name": "Format for Sheets",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 667122089,
          "mode": "list",
          "cachedResultName": "Matching_Results",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=667122089"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "slip_ref"
          ],
          "schema": [
            {
              "id": "match_timestamp",
              "displayName": "match_timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "match_status",
              "displayName": "match_status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "match_type",
              "displayName": "match_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "is_blacklisted",
              "displayName": "is_blacklisted",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "slip_ref",
              "displayName": "slip_ref",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "slip_datetime",
              "displayName": "slip_datetime",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "slip_amount",
              "displayName": "slip_amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "slip_sender",
              "displayName": "slip_sender",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "slip_bank",
              "displayName": "slip_bank",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "stm_ref",
              "displayName": "stm_ref",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "stm_datetime",
              "displayName": "stm_datetime",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "stm_amount",
              "displayName": "stm_amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "blacklist_account        ",
              "displayName": "blacklist_account        ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "blacklist_details",
              "displayName": "blacklist_details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3024,
        -1232
      ],
      "id": "ed3ff5b5-a39d-48b8-b119-5f68357656e1",
      "name": "m_results",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "fd03a841-45e8-46c6-9911-61c447e8dc32",
              "leftValue": "={{ $json.confidence_score }}",
              "rightValue": 0.99,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -7440,
        -1200
      ],
      "id": "54b90e45-d3f7-4ea1-a18b-a2290fb36fb9",
      "name": "QC"
    },
    {
      "parameters": {
        "content": "## RestRoom ðŸ˜‰\n**à¸£à¸§à¸¡=>dtSet/1** t\"à¸«à¹‰à¸­à¸‡à¸žà¸±à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥\" à¸¡à¸±à¸™à¸ˆà¸°à¸£à¸§à¸šà¸£à¸§à¸¡à¹„à¸Ÿà¸¥à¹Œà¸—à¸¸à¸à¹ƒà¸šà¸—à¸µà¹ˆà¸§à¸´à¹ˆà¸‡à¸¡à¸²à¸–à¸¶à¸‡à¸¡à¸±à¸™à¸ à¸²à¸¢à¹ƒà¸™à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸² 10 à¸§à¸´à¸™à¸²à¸—à¸µ à¹ƒà¸«à¹‰à¸à¸¥à¸²à¸¢à¹€à¸›à¹‡à¸™ \"à¸Šà¸¸à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥\" à¸Šà¸¸à¸”à¹€à¸”à¸µà¸¢à¸§"
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -7040,
        -2208
      ],
      "typeVersion": 1,
      "id": "070ef4bb-5351-4d2a-b44c-0bf8e032365b",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "operation": "formatDate",
        "date": "=",
        "options": {}
      },
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        -6352,
        -1168
      ],
      "id": "79a6efdc-3e83-420d-ba05-a8035230d998",
      "name": "Date & Time",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// --- Input Data ---\n// item[0] à¸ˆà¸°à¹€à¸›à¹‡à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸¥à¸´à¸›à¸—à¸µà¹ˆà¸œà¹ˆà¸²à¸™à¸à¸²à¸£à¹à¸›à¸¥à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§\n// item[1] à¸ˆà¸°à¹€à¸›à¹‡à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸­à¸±à¸•à¸£à¸²à¹à¸¥à¸à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ˆà¸²à¸ API à¸˜à¸›à¸—.\n\nconst slipData = items[0].json;\nconst exchangeRateApiResponse = items[1].json;\n\nconst originalAmount = parseFloat(slipData.à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™);\nconst originalCurrency = slipData.à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™; // à¸£à¸±à¸šà¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™à¹à¸šà¸šà¹„à¸”à¸™à¸²à¸¡à¸´à¸\n\n// --- Initialize Variables ---\nlet amount_thb = null;\nlet exchange_rate_used = null;\nlet rate_found = false;\n\n// --- Logic ---\n// à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² API à¸•à¸­à¸šà¸à¸¥à¸±à¸šà¸¡à¸²à¸žà¸£à¹‰à¸­à¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ\nif (exchangeRateApiResponse.result && exchangeRateApiResponse.result.data.data_detail.length > 0) {\n  const rates = exchangeRateApiResponse.result.data.data_detail;\n  \n  // à¸„à¹‰à¸™à¸«à¸²à¸­à¸±à¸•à¸£à¸²à¹à¸¥à¸à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸‚à¸­à¸‡à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸ˆà¸²à¸ response à¸‚à¸­à¸‡ API\n  const rateInfo = rates.find(rate => rate.currency_id === originalCurrency);\n  \n  if (rateInfo) {\n    // à¹ƒà¸Šà¹‰ mid_rate (à¸­à¸±à¸•à¸£à¸²à¸à¸¥à¸²à¸‡) à¹€à¸žà¸·à¹ˆà¸­à¸„à¸§à¸²à¸¡à¹à¸¡à¹ˆà¸™à¸¢à¸³\n    exchange_rate_used = parseFloat(rateInfo.mid_rate);\n    // à¸„à¸³à¸™à¸§à¸“à¹€à¸›à¹‡à¸™à¹€à¸‡à¸´à¸™à¸šà¸²à¸—à¹à¸¥à¸°à¸›à¸±à¸”à¹€à¸¨à¸©\n    amount_thb = (originalAmount * exchange_rate_used).toFixed(2);\n    rate_found = true;\n  }\n}\n\n// --- Handle Errors ---\n// à¸à¸£à¸“à¸µà¸«à¸²à¹€à¸£à¸—à¹„à¸¡à¹ˆà¹€à¸ˆà¸­ (à¸­à¸²à¸ˆà¹€à¸›à¹‡à¸™à¸§à¸±à¸™à¸«à¸¢à¸¸à¸” à¸«à¸£à¸·à¸­à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸¡à¸µà¹ƒà¸™ API)\nif (!rate_found) {\n  // à¸„à¸¸à¸“à¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸žà¸´à¹ˆà¸¡à¸à¸²à¸£à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™ Error à¸«à¸£à¸·à¸­à¹ƒà¸ªà¹ˆà¸„à¹ˆà¸² default à¹„à¸”à¹‰à¸—à¸µà¹ˆà¸™à¸µà¹ˆ\n  // à¹ƒà¸™à¸•à¸­à¸™à¸™à¸µà¹‰à¹€à¸£à¸²à¸ˆà¸°à¸›à¸¥à¹ˆà¸­à¸¢à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™ null à¹„à¸›à¸à¹ˆà¸­à¸™\n}\n\n// --- Output ---\n// à¹€à¸žà¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¹„à¸›à¹ƒà¸™ Object à¹€à¸”à¸´à¸¡à¸‚à¸­à¸‡à¸ªà¸¥à¸´à¸›\nslipData.amount_thb = amount_thb;\nslipData.exchange_rate_used = exchange_rate_used;\n\n// à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œà¹à¸¥à¹‰à¸§à¸à¸¥à¸±à¸šà¸­à¸­à¸à¹„à¸›\nreturn slipData;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6032,
        -1168
      ],
      "id": "0ff9d4e1-5d26-4c31-8ab3-a3fd4a0e9c0f",
      "name": "Cal THB",
      "disabled": true
    },
    {
      "parameters": {
        "mode": "expression",
        "output": "={{ $json[\"callback_query\"] ? 0 : ($json[\"message\"] && $json[\"message\"][\"reply_to_message\"] ? 1 : ($json[\"message\"] && ($json[\"message\"][\"photo\"] || $json[\"message\"][\"document\"]) ? 2 : 3)) }}\n"
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -11232,
        -1168
      ],
      "id": "d3678df8-ea15-4671-b213-99fc1deecac4",
      "name": "Switch Types"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "=1660316786",
          "mode": "id"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡": "={{ $('JS-AI').item.json['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™": "={{ $('JS-AI').item.json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}",
            "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™": "={{ $json['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] }}",
            "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£": "={{ $json['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] }}",
            "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³": "={{ $json['à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³'] }}",
            "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}"
          },
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "displayName": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -6016,
        -912
      ],
      "id": "93cc8c5a-6028-452c-9c5e-fc7f15201247",
      "name": "$",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "const matches = $json.matches || [];\nconst notFound = $json.notFound || [];\nconst outMsgs = [];\n\nif (matches.length === 0 && notFound.length === 0) {\n  outMsgs.push(\"à¹„à¸¡à¹ˆà¸žà¸šà¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆà¸ˆà¸°à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š (à¹„à¸¡à¹ˆà¸¡à¸µ slips/statements)\");\n} else {\n  outMsgs.push(`à¸ªà¸£à¸¸à¸›à¸à¸²à¸£à¸•à¸£à¸§à¸ˆ: à¸žà¸š ${matches.length} à¸£à¸²à¸¢à¸à¸²à¸£ match, ${notFound.length} à¸£à¸²à¸¢à¸à¸²à¸£à¹„à¸¡à¹ˆà¸žà¸š`);\n  matches.forEach((m, idx) => {\n    const slipAcc = m.slipAccount || (m.slip && (m.slip['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ']||''));\n    const stAcc = m.statementAccount || (m.statement && (m.statement['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ']||''));\n    const black = m.blacklist ? \"âŒ à¸–à¸¹à¸ blacklist\" : \"âœ… à¹„à¸¡à¹ˆà¸žà¸šà¹ƒà¸™ blacklist\";\n    const nameMatch = (m.nameMatch === null) ? \"à¸Šà¸·à¹ˆà¸­à¹„à¸¡à¹ˆà¸žà¸­à¸‚à¹‰à¸­à¸¡à¸¹à¸¥\" : (m.nameMatch ? \"à¸Šà¸·à¹ˆà¸­à¸•à¸£à¸‡à¸à¸±à¸™\" : \"à¸Šà¸·à¹ˆà¸­à¹„à¸¡à¹ˆà¸•à¸£à¸‡\");\n    const amt = m.slip && (m.slip['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] || '');\n    const refSlip = m.slip && (m.slip['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡']||'');\n    const refSt = m.statement && (m.statement['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡']||'');\n    outMsgs.push(`\\n#${idx+1} (${m.matchType})\nà¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ (slip) : ${slipAcc}\nà¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ (statement): ${stAcc}\nà¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™: ${amt}\nref (slip/stm): ${refSlip} / ${refSt}\n${black} | ${nameMatch}`);\n  });\n  if (notFound.length) {\n    outMsgs.push(\"\\nà¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆà¸«à¸²à¹„à¸¡à¹ˆà¸žà¸šà¹ƒà¸™ statement:\");\n    notFound.forEach((n,i)=>{\n      const slipAcc = n.slip && (n.slip['à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸à¸Šà¸µ']||'');\n      const amt = n.slip && (n.slip['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™']||'');\n      outMsgs.push(`${i+1}. à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ: ${slipAcc} à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™: ${amt} blacklist: ${n.blacklist ? 'âŒ':''}`);\n    });\n  }\n}\n\nreturn [{ json: { text: outMsgs.join(\"\\n\\n\") } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3184,
        -976
      ],
      "id": "d4ea5a7e-3f9f-40ba-bde0-f04380266df4",
      "name": "dashboard",
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.iapp.co.th/document-ocr/ocr",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "HieW8Y2y3rqjG8lXqvPHuDUWjGVlXrbL"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8576,
        -1408
      ],
      "id": "f39fba05-678b-4dd2-ab8f-ceaca39c89b4",
      "name": "iAppTech",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1771171886,
          "mode": "list",
          "cachedResultName": "KBank",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=1771171886"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡": "={{ $json['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}",
            "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™": "={{ $json['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] }}",
            "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£": "={{ $json['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] }}",
            "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³": "={{ $json['à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³'] }}",
            "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}"
          },
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "displayName": "à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -5456,
        -1200
      ],
      "id": "848c4b68-1d4a-4572-a918-ad29064decd9",
      "name": "KBank",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
                    "rightValue": "SCB",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "359c0581-9e57-43aa-ad94-e8c0ae2cc5b6"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4efbb30f-5042-4772-8de1-09d248599736",
                    "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
                    "rightValue": "StmKB",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "238333ae-2760-4c1a-a814-9f2e519af922",
                    "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
                    "rightValue": "=PromptPay",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "47492068-6d41-4c0d-9879-eb3dff3911e9",
                    "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
                    "rightValue": "StmMymo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8289ec14-6337-4303-8e8b-3cec224727e5",
                    "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
                    "rightValue": "StmMBK",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9bcc8619-8565-41f7-8aec-b107eba46597",
                    "leftValue": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
                    "rightValue": "KTB",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -7760,
        -608
      ],
      "id": "47b74efa-13f1-4087-a395-946f6b0be8b2",
      "name": "Switch2"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1641093238,
          "mode": "list",
          "cachedResultName": "Stm_SCB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=1641093238"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡": "={{ $json['à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¹€à¸Šà¹‡à¸„/à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}",
            "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™": "={{ $json['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] }}",
            "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£": "={{ $json['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] }}",
            "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”": "={{ $json['à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”'] }}",
            "TYPE": "={{ $json.type }}",
            "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
            "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­": "={{ $json['à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­'] }}"
          },
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”",
              "displayName": "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
              "displayName": "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "TYPE",
              "displayName": "TYPE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -7152,
        -640
      ],
      "id": "456f861a-903f-48b8-9df0-5eebbe1b1ad7",
      "name": "StmSCB",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1771171886,
          "mode": "list",
          "cachedResultName": "KBank",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=1771171886"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡": "={{ $json['à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¹€à¸Šà¹‡à¸„/à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}",
            "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™": "={{ $json['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] }}",
            "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£": "={{ $json['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] }}",
            "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”": "={{ $json['à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”'] }}",
            "TYPE": "={{ $json.type }}",
            "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
            "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­": "={{ $json['à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­'] }}"
          },
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”",
              "displayName": "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
              "displayName": "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "TYPE",
              "displayName": "TYPE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -7152,
        -448
      ],
      "id": "d28d9fcb-00b3-4f9f-8a05-1b3c6f6f05d4",
      "name": "StmKB",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1793208727,
          "mode": "list",
          "cachedResultName": "Stm_BBL",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=1793208727"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡": "={{ $json['à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¹€à¸Šà¹‡à¸„/à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}",
            "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™": "={{ $json['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] }}",
            "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£": "={{ $json['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] }}",
            "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”": "={{ $json['à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”'] }}",
            "TYPE": "={{ $json.type }}",
            "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
            "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­": "={{ $json['à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­'] }}"
          },
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”",
              "displayName": "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
              "displayName": "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "TYPE",
              "displayName": "TYPE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -7152,
        -272
      ],
      "id": "afacfa36-2cca-4857-86de-81b5720cc4b9",
      "name": "StmBBL",
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1231796122,
          "mode": "list",
          "cachedResultName": "Stm_Mymo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=1231796122"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡": "={{ $json['à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¹€à¸Šà¹‡à¸„/à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}",
            "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™": "={{ $json['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] }}",
            "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£": "={{ $json['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] }}",
            "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”": "={{ $json['à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”'] }}",
            "TYPE": "={{ $json.type }}",
            "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
            "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­": "={{ $json['à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­'] }}"
          },
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”",
              "displayName": "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
              "displayName": "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "TYPE",
              "displayName": "TYPE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -7152,
        -112
      ],
      "id": "d2893450-abb9-4772-900e-5d594c2f9da0",
      "name": "StmMymo",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1399242499,
          "mode": "list",
          "cachedResultName": "Stm_Make",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=1399242499"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡": "={{ $json['à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¹€à¸Šà¹‡à¸„/à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}",
            "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™": "={{ $json['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] }}",
            "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£": "={{ $json['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] }}",
            "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”": "={{ $json['à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”'] }}",
            "TYPE": "={{ $json.type }}",
            "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
            "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­": "={{ $json['à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­'] }}"
          },
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”",
              "displayName": "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
              "displayName": "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "TYPE",
              "displayName": "TYPE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -7152,
        64
      ],
      "id": "2277c57a-3d47-4580-9c22-d3139cd08e90",
      "name": "StmMBK",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 517963163,
          "mode": "list",
          "cachedResultName": "Stm_KTB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=517963163"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡": "={{ $json['à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¹€à¸Šà¹‡à¸„/à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}",
            "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š": "={{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}",
            "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™": "={{ $json['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] }}",
            "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£": "={{ $json['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] }}",
            "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”": "={{ $json['à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”'] }}",
            "TYPE": "={{ $json.type }}",
            "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£": "={{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
            "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­": "={{ $json['à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­'] }}"
          },
          "matchingColumns": [
            "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡"
          ],
          "schema": [
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "displayName": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "displayName": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "displayName": "à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "displayName": "à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”",
              "displayName": "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "displayName": "à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
              "displayName": "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "TYPE",
              "displayName": "TYPE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -7152,
        240
      ],
      "id": "8ab36a4f-c2c0-440b-8aa8-e5d076664025",
      "name": "StmKTb",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1641093238,
          "mode": "list",
          "cachedResultName": "Stm_SCB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=1641093238"
        },
        "options": {
          "outputFormatting": {
            "values": {
              "general": "FORMATTED_VALUE",
              "date": "FORMATTED_STRING"
            }
          },
          "returnFirstMatch": false
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -5920,
        -480
      ],
      "id": "d42dabc2-5edb-4904-b047-a21b7a9df0c2",
      "name": "Getscb1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 781640787,
          "mode": "list",
          "cachedResultName": "AllSlips",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=781640787"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -4704,
        -1200
      ],
      "id": "e4807b99-dd7b-47a3-89ed-d90312eda29a",
      "name": "GetAllSlips",
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "134fbcda-262e-4084-8152-2dc9bbcbd990",
                    "leftValue": "={{ $json.queryType }}",
                    "rightValue": "number",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a2aa1b13-1968-4a89-b04e-da0aca1c2c80",
                    "leftValue": "={{ $json.queryType }}",
                    "rightValue": "name",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -10096,
        -2048
      ],
      "id": "99f8874f-94fe-407b-8ca8-3c9837cf7214",
      "name": "Ac or Name?"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.blacklistseller.com/api/api/v1/queries/bank-detail/",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "X-API-Key",
              "value": "wJNw3Cg6GWMI-ZuaP60exjg4WSG_9aCr6XOO3uIhDSI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.query }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -9808,
        -2544
      ],
      "id": "722f0895-abe1-4e4b-b699-e8da52a0be59",
      "name": "bank-detail",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.blacklistseller.com/api/api/v1/queries/fullname-summary/",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "X-API-Key",
              "value": "wJNw3Cg6GWMI-ZuaP60exjg4WSG_9aCr6XOO3uIhDSI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.query }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -9792,
        -2080
      ],
      "id": "68349c92-4302-4fcd-82f3-124ea92ab0bd",
      "name": "name-sum",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.blacklistseller.com/api/api/v1/queries/fullname-detail/",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "X-API-Key",
              "value": "wJNw3Cg6GWMI-ZuaP60exjg4WSG_9aCr6XOO3uIhDSI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.query }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -9792,
        -1904
      ],
      "id": "74f7d145-ee92-448d-8f00-53434f2cd63d",
      "name": "name-del",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -9488,
        -1984
      ],
      "id": "18a54abb-7192-4a4d-85d4-06d3081aa3a3",
      "name": "MergeName"
    },
    {
      "parameters": {
        "jsCode": "// --- 1. \"à¹à¸à¸°à¸à¸¥à¹ˆà¸­à¸‡\" à¸Šà¸±à¹‰à¸™à¸™à¸­à¸à¸ªà¸¸à¸”à¸à¹ˆà¸­à¸™ ---\n// 'data' à¸„à¸·à¸­à¸à¸¥à¹ˆà¸­à¸‡à¹ƒà¸«à¸à¹ˆà¸—à¸µà¹ˆà¸«à¹ˆà¸­à¸—à¸¸à¸à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸§à¹‰ à¸‹à¸¶à¹ˆà¸‡à¸à¹‡à¸„à¸·à¸­ items[0].json\nconst data = items[0].json;\n\n// --- 2. à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸à¹à¸•à¹ˆà¸¥à¸°à¸ªà¹ˆà¸§à¸™à¹ƒà¸™à¸à¸¥à¹ˆà¸­à¸‡ ---\n// 'records' à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ \"à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸ˆà¸²à¸ API\" à¸‹à¸¶à¹ˆà¸‡à¹€à¸à¹‡à¸šà¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ property 'body'\nconst records = data.body.result?.data || [];\n\nlet firstName = '';\nlet lastName = '';\n\n// --- 3. à¸ªà¸à¸±à¸”à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥ (à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡) ---\nif (records.length > 0) {\n  firstName = records[0].first_name || '';\n  lastName = records[0].last_name || '';\n}\n\n// --- 4. à¸ªà¸£à¹‰à¸²à¸‡ query à¹ƒà¸«à¸¡à¹ˆ à¹à¸¥à¸°à¸ªà¹ˆà¸‡à¸•à¹ˆà¸­à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” ---\n// à¹€à¸£à¸²à¸ˆà¸°à¸ªà¹ˆà¸‡à¸•à¹ˆà¸­ \"à¸à¸¥à¹ˆà¸­à¸‡à¹ƒà¸«à¸à¹ˆ\" (data) à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹„à¸›à¹€à¸¥à¸¢ à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸•à¸à¸«à¸¥à¹ˆà¸™\nreturn [{\n  json: {\n    ...data, // à¸ªà¹ˆà¸‡à¸•à¹ˆà¸­à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹ƒà¸™à¸à¸¥à¹ˆà¸­à¸‡à¹ƒà¸«à¸à¹ˆ (à¸—à¸±à¹‰à¸‡ body à¹à¸¥à¸° json à¹€à¸”à¸´à¸¡)\n    fullname_query: { \n      \"first_name\": firstName,\n      \"last_name\": lastName\n    } // à¹à¸¥à¹‰à¸§à¹€à¸žà¸´à¹ˆà¸¡ query à¹ƒà¸«à¸¡à¹ˆà¸‚à¸­à¸‡à¹€à¸£à¸²à¹€à¸‚à¹‰à¸²à¹„à¸›\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -9552,
        -2384
      ],
      "id": "701898aa-e9d2-421e-a25d-b2ad849b3ac6",
      "name": "Extract Fullname & Prepare"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.blacklistseller.com/api/api/v1/queries/fullname-summary/",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "X-API-Key",
              "value": "wJNw3Cg6GWMI-ZuaP60exjg4WSG_9aCr6XOO3uIhDSI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.fullname_query }}",
        "options": {
          "response": {
            "response": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -9344,
        -2448
      ],
      "id": "d167eb44-06ec-47fa-b53c-9609c25f9bda",
      "name": "name-sum4Bank",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.blacklistseller.com/api/api/v1/queries/fullname-detail/",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "X-API-Key",
              "value": "wJNw3Cg6GWMI-ZuaP60exjg4WSG_9aCr6XOO3uIhDSI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.fullname_query }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -9344,
        -2256
      ],
      "id": "bba14305-9fcd-456b-bbaa-4b348f9d757a",
      "name": "name-del4Bank",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -9104,
        -2320
      ],
      "id": "aac7a10b-a0d7-47ff-978a-77b38b7ebb76",
      "name": "Merge Bank Results"
    },
    {
      "parameters": {
        "jsCode": "// à¹à¸¢à¸ records/data à¹ƒà¸™ CheckBlack à¸­à¸­à¸à¹€à¸›à¹‡à¸™ item à¹à¸¢à¸\nconst base = {\n  account: $json.account || $json.data?.[0]?.account || 'à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸',\n  found: $json.found ?? true,\n  reports_count: $json.reports_count || $json.data?.length || 0,\n  total_loss: $json.total_price || $json.total_loss || 0,\n};\n\n// à¸•à¸£à¸§à¸ˆà¹€à¸§à¸¥à¸²à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š\nconst nowThai = $now.setZone('Asia/Bangkok').toFormat('dd/MM/yyyy HH:mm:ss', { locale: 'th' });\n\n// à¸–à¹‰à¸²à¹€à¸ˆà¸­à¹ƒà¸™ blacklist (found = true) à¹ƒà¸Šà¹‰à¹€à¸§à¸¥à¸²à¸ˆà¸²à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸£à¸´à¸‡\n// à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹€à¸ˆà¸­ (found = false) à¹ƒà¸Šà¹‰à¹€à¸§à¸¥à¸²à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™à¹€à¸¥à¸¢\nbase[\"à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸\"] =\n  base.found === false\n    ? nowThai\n    : ($json.data?.[0]?.date || nowThai);\n\nconst records = $json.data || $json.records || [];\nif (!Array.isArray(records) || records.length === 0) {\n  return [{ json: base }];\n}\n\nreturn records.map(r => ({\n  json: {\n    ...base,\n    report_id: r.report_id || '',\n    product: r.product || '',\n    price: r.price || '',\n    detail_text: r.detail_text || '',\n    website: r.website || '',\n    bank_number: (r.banks && r.banks[0]?.bank_number) || '',\n    bank_abbre: (r.banks && r.banks[0]?.abbre) || '',\n    // à¸–à¹‰à¸²à¸¡à¸µ date à¸ˆà¸£à¸´à¸‡à¹ƒà¸™ record à¹ƒà¸Šà¹‰à¸­à¸±à¸™à¸™à¸±à¹‰à¸™ à¹„à¸¡à¹ˆà¸‡à¸±à¹‰à¸™ fallback à¹€à¸›à¹‡à¸™à¸§à¸±à¸™à¸•à¸£à¸§à¸ˆà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™\n    \"à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸\": r.date || nowThai\n  },\n}));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8624,
        -1824
      ],
      "id": "7f5a2639-1f36-48ee-9d52-6e8281a43140",
      "name": "SplitRecords"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc",
          "mode": "list",
          "cachedResultName": "slip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2032423560,
          "mode": "list",
          "cachedResultName": "Blacklist",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1rclnpb5VozipxHssUtAym09aqOElnmj8uQo1tsoNGNc/edit#gid=2032423560"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸•à¹‰à¸­à¸‡à¸ªà¸‡à¸ªà¸±à¸¢",
              "lookupValue": "={{ ($json.query.first_name + \" \" + $json.query.last_name).toLowerCase() }}"
            },
            {
              "lookupColumn": "à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ",
              "lookupValue": "={{ $json.query.bank_number || \"\" }}"
            }
          ]
        },
        "combineFilters": "OR",
        "options": {
          "returnFirstMatch": true
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -10704,
        -2096
      ],
      "id": "1af72f08-aa0d-44d3-84a4-a491150dba7e",
      "name": "4Cache",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QFtskcJyZAep9z1d",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// --- Node: ProcessLookup (Corrected Version) ---\nconst allInputs = $input.all(); // Input à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (à¸ˆà¸²à¸ 4Cache)\nconst originalInput = $('UserReplyAc').item.json; // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸”à¸±à¹‰à¸‡à¹€à¸”à¸´à¸¡à¸ˆà¸²à¸ UserReplyAc\n\nconst CACHE_EXPIRY_DAYS = 30; // à¸›à¸£à¸±à¸šà¸•à¸²à¸¡à¸™à¹‚à¸¢à¸šà¸²à¸¢\n\n// --- 1. à¸”à¸¶à¸‡ \"à¸„à¸³à¸„à¹‰à¸™à¸«à¸²\" à¸ˆà¸²à¸ UserReplyAc ---\nlet queryValue = '';\nif (originalInput.query?.bank_number) {\n  queryValue = String(originalInput.query.bank_number);\n} else if (originalInput.query?.first_name && originalInput.query?.last_name) {\n  queryValue = `${originalInput.query.first_name} ${originalInput.query.last_name}`;\n} else {\n  queryValue = originalInput.raw || ''; // Fallback à¹ƒà¸Šà¹‰ raw input\n}\n// Clean query for comparison (à¸–à¹‰à¸²à¹€à¸›à¹‡à¸™à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ)\nconst cleanQuery = queryValue.replace(/\\D/g, '').trim();\nconst queryIsNumeric = originalInput.queryType === 'number';\n\nlet foundInSheet = false;\nlet cacheData = null;\nlet isFresh = false;\n\n// Helper function to normalize account number\nfunction normalizeAccount(val) {\n  if (val === null || val === undefined) return '';\n  return String(val).replace(/\\D/g, '').trim();\n}\n// Helper function to normalize name\nfunction normalizeName(val) {\n   if (val === null || val === undefined) return '';\n   // à¸¥à¸šà¸„à¸³à¸™à¸³à¸«à¸™à¹‰à¸², à¹€à¸§à¹‰à¸™à¸§à¸£à¸£à¸„, à¸—à¸³à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹€à¸¥à¹‡à¸ (à¸­à¸²à¸ˆà¸•à¹‰à¸­à¸‡à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡à¹€à¸žà¸´à¹ˆà¸¡)\n   return String(val).toLowerCase().replace(/^(à¸™à¸²à¸¢|à¸™à¸²à¸‡à¸ªà¸²à¸§|à¸™à¸²à¸‡|à¸™\\.à¸ª\\.)\\s*/, '').replace(/\\s+/g, '');\n}\n\n// --- 2. à¸§à¸™à¸¥à¸¹à¸›à¸«à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸•à¸£à¸‡à¸à¸±à¸™à¹ƒà¸™ Input (à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸ˆà¸²à¸ 4Cache) ---\nfor (const item of allInputs) {\n  const j = item.json || {};\n\n  // Check if the item itself is the direct row data (like from your 4Cache output)\n  if (j['à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ'] || j['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸•à¹‰à¸­à¸‡à¸ªà¸‡à¸ªà¸±à¸¢'] || j['report_id'] || j['row_number']) {\n    let match = false;\n    if (queryIsNumeric) {\n      const accInSheet = normalizeAccount(j['à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ']);\n      if (accInSheet && accInSheet === cleanQuery) {\n        match = true;\n      }\n    } else {\n      // Compare names (à¸­à¸²à¸ˆà¸•à¹‰à¸­à¸‡à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡ logic à¸à¸²à¸£à¹€à¸—à¸µà¸¢à¸šà¸Šà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸”à¸µà¸‚à¸¶à¹‰à¸™)\n      const nameInSheet = normalizeName(j['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸•à¹‰à¸­à¸‡à¸ªà¸‡à¸ªà¸±à¸¢']);\n      const queryNameNormalized = normalizeName(queryValue);\n      if (nameInSheet && queryNameNormalized && nameInSheet === queryNameNormalized) {\n        match = true;\n      }\n    }\n\n    if (match) {\n      foundInSheet = true;\n      cacheData = j; // à¹ƒà¸Šà¹‰à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸–à¸§à¸—à¸µà¹ˆà¹€à¸ˆà¸­à¹‚à¸”à¸¢à¸•à¸£à¸‡\n      break; // à¹€à¸ˆà¸­à¹à¸¥à¹‰à¸§ à¸­à¸­à¸à¹€à¸¥à¸¢\n    }\n  }\n  // (à¸­à¸²à¸ˆà¹€à¸žà¸´à¹ˆà¸¡ logic à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š j.rows à¸«à¸£à¸·à¸­ j.row à¸–à¹‰à¸² Node à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²à¸ªà¹ˆà¸‡à¸¡à¸²à¹ƒà¸™à¸£à¸¹à¸›à¹à¸šà¸šà¸­à¸·à¹ˆà¸™)\n}\n\n// --- 3. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸ªà¸”à¹ƒà¸«à¸¡à¹ˆ (à¸–à¹‰à¸²à¹€à¸ˆà¸­) ---\nif (foundInSheet && cacheData) {\n  // à¸žà¸¢à¸²à¸¢à¸²à¸¡à¸«à¸² timestamp à¸ˆà¸²à¸à¸«à¸¥à¸²à¸¢à¹† field à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¹„à¸›à¹„à¸”à¹‰\n  const ts = cacheData.timestamp || cacheData['timestamp'] || cacheData['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸'] || cacheData['date'] || null;\n  if (ts) {\n    try {\n      const last = new Date(ts);\n      const now = new Date();\n      const diffDays = (now - last) / (1000 * 60 * 60 * 24);\n      isFresh = diffDays <= CACHE_EXPIRY_DAYS;\n    } catch (e) {\n      console.error(\"Error parsing cache timestamp:\", ts, e);\n      isFresh = false; // à¸–à¹‰à¸²à¹à¸›à¸¥à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹„à¸”à¹‰ à¸–à¸·à¸­à¸§à¹ˆà¸²à¹„à¸¡à¹ˆà¸ªà¸”\n    }\n  } else {\n    isFresh = false; // à¹„à¸¡à¹ˆà¸¡à¸µ timestamp à¸–à¸·à¸­à¸§à¹ˆà¸²à¹„à¸¡à¹ˆà¸ªà¸”\n  }\n}\n\n// --- 4. à¸„à¸·à¸™à¸„à¹ˆà¸² ---\nreturn [{\n  json: {\n    ...originalInput, // à¸ªà¹ˆà¸‡à¸•à¹ˆà¸­à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸”à¸´à¸¡à¸ˆà¸²à¸ UserReplyAc\n    cache: {\n      foundInSheet,\n      isFresh,\n      data: cacheData // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸à¸Šà¸µà¸—à¸—à¸µà¹ˆà¹€à¸ˆà¸­ (à¸«à¸£à¸·à¸­ null à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹€à¸ˆà¸­)\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -10512,
        -2160
      ],
      "id": "f2bfc7df-7741-471e-91a0-46c1318e63cf",
      "name": "ProcessLookup"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.cache.foundInSheet }}",
                    "rightValue": "=true",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "90d539c9-b828-429b-84b9-eaa9b96be31c"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Use Cache"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a423bf83-9c7f-452b-845d-daba0020fbb5",
                    "leftValue": "={{ $json.cache.foundInSheet }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "false",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Call API"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -10352,
        -2160
      ],
      "id": "5fa0c1b5-39a6-4ea5-b137-11c3ea1bc4ad",
      "name": "DecideUseCache"
    },
    {
      "parameters": {
        "jsCode": "// Node: FormatCachedData (Adapted for 'Blacklist' Sheet Structure)\nconst originalInput = $('UserReplyAc').item.json;\nconst c = $json.cache?.data || {}; // Data from the 'Blacklist' sheet row found by 4Cache\n\n// --- 1. Determine 'account' based on original query type ---\nlet account = '';\n// à¹ƒà¸Šà¹‰à¸„à¹ˆà¸²à¸ˆà¸²à¸à¸Šà¸µà¸—à¸à¹ˆà¸­à¸™ à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¹ˆà¸­à¸¢à¹ƒà¸Šà¹‰à¸ˆà¸²à¸ query à¹€à¸”à¸´à¸¡\nif (originalInput.queryType === 'number') {\n  account = String(c['à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ'] || originalInput.query?.bank_number || '');\n} else {\n  account = c['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸•à¹‰à¸­à¸‡à¸ªà¸‡à¸ªà¸±à¸¢'] || `${originalInput.query?.first_name || ''} ${originalInput.query?.last_name || ''}`.trim();\n}\n// Clean the account number if needed (remove non-digits)\nif (originalInput.queryType === 'number') {\n  account = account.replace(/\\D/g, '');\n}\n\n\n// --- 2. Extract summary info using Thai column names ---\n// à¹à¸›à¸¥à¸‡ 'Status' (à¸­à¸²à¸ˆà¹€à¸›à¹‡à¸™ boolean true/false à¸«à¸£à¸·à¸­ string 'true'/'false') à¹€à¸›à¹‡à¸™ boolean\nconst found = (String(c.Status || 'false').toLowerCase() === 'true');\n// à¹à¸›à¸¥à¸‡ 'à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”' à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹€à¸¥à¸‚, à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µà¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™ 0\nconst reports_count = parseInt(c['à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”'] || 0);\n// à¹à¸›à¸¥à¸‡ 'TotalPrice' à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹€à¸¥à¸‚à¸—à¸¨à¸™à¸´à¸¢à¸¡, à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µà¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™ 0\nconst total_loss = parseFloat(c.TotalPrice || 0);\n\n// --- 3. Construct a SINGLE 'record' object from the cache row ---\n// *** à¸ªà¸³à¸„à¸±à¸: à¸™à¸µà¹ˆà¸ˆà¸°à¸¡à¸µà¹à¸„à¹ˆà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸à¹à¸–à¸§à¹€à¸”à¸µà¸¢à¸§ à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸—à¸¸à¸ records à¹€à¸«à¸¡à¸·à¸­à¸™ API ***\nconst singleRecord = {\n  report_id: c.report_id || null,\n  product: c.product || null,\n  price: parseFloat(c.Price || 0), // à¹à¸›à¸¥à¸‡ 'Price' à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹€à¸¥à¸‚\n  detail_text: c.details || null,\n  date: c['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸'] || null,\n  website: c.website || null,\n  banks: [{ // à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡ banks à¹ƒà¸«à¹‰à¸„à¸¥à¹‰à¸²à¸¢ API\n    bank_id: null, // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ bank_id à¹„à¸¡à¹ˆà¸¡à¸µà¹ƒà¸™à¸Šà¸µà¸—à¸™à¸µà¹‰\n    bank_number: String(c['à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ'] || ''), // à¹ƒà¸Šà¹‰ 'à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ'\n    abbre: c.bank || null // à¹ƒà¸Šà¹‰ 'bank' (à¹€à¸Šà¹ˆà¸™ KTB)\n  }],\n  // à¹ƒà¸ªà¹ˆà¸„à¹ˆà¸² summary à¸¥à¸‡à¹ƒà¸™ record à¹à¸£à¸ à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¹ƒà¸à¸¥à¹‰à¹€à¸„à¸µà¸¢à¸‡ API response\n  freq_count: reports_count,\n  total_price: total_loss\n};\n\n// --- 4. Get source_chat_id ---\nconst source_chat_id = originalInput.source_chat_id || null;\n\n// --- 5. Get timestamp ---\n// *** à¸ªà¸³à¸„à¸±à¸: Sheet 'Blacklist' à¹„à¸¡à¹ˆà¸¡à¸µ timestamp à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ˆà¸£à¸´à¸‡à¹† ***\n// à¹€à¸£à¸²à¸ˆà¸°à¹ƒà¸Šà¹‰ 'à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸' à¹à¸—à¸™à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§ à¹à¸•à¹ˆà¸¡à¸±à¸™à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¹€à¸§à¸¥à¸² cache à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡\nconst cache_timestamp = c['à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹€à¸«à¸•à¸¸'] || null;\n\n// --- 6. Return formatted data ---\nreturn [{\n  json: {\n    account: account,\n    found: found,\n    reports_count: reports_count,\n    total_loss: total_loss,\n    // à¸–à¹‰à¸² 'found' à¹€à¸›à¹‡à¸™ true à¹ƒà¸«à¹‰à¸ªà¹ˆà¸‡ singleRecord à¹ƒà¸™ array, à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹€à¸ˆà¸­ à¸ªà¹ˆà¸‡ array à¸§à¹ˆà¸²à¸‡\n    records: found ? [singleRecord] : [],\n    source_chat_id: source_chat_id,\n    _cached: true, // à¸šà¸­à¸à¸§à¹ˆà¸²à¸¡à¸²à¸ˆà¸²à¸ Cache\n    _cache_timestamp: cache_timestamp // à¹ƒà¸Šà¹‰ timestamp à¸ˆà¸²à¸à¸Šà¸µà¸— (à¹„à¸¡à¹ˆà¹à¸¡à¹ˆà¸™à¸¢à¸³)\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -10080,
        -2288
      ],
      "id": "cc72cb3e-a2a7-4613-9572-1d897ba34687",
      "name": "FormatCachedData"
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "destinationKey": "base64",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -9008,
        -1120
      ],
      "id": "f08a7be4-20b3-4517-a37e-16505bf5d354",
      "name": "Extract from File1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://vision.googleapis.com/v1/images:annotate?key=AIzaSyCSd5Kn24vQSVaSulSlA3Nx3i7cDefC5Hg",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"requests\": [\n    {\n      \"image\": {\n        \"content\": \"{{ $json.base64 }}\"\n      },\n      \"features\": [\n        {\n          \"type\": \"DOCUMENT_TEXT_DETECTION\"\n        }\n      ],\n      \"imageContext\": {\n        \"languageHints\": [\n          \"th\"\n        ]\n      }\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8352,
        -1408
      ],
      "id": "2e5c1cc2-1ae0-42d5-8745-b3b21a7297d8",
      "name": "CloudVission2",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// Build Cloud Vision Batch Request (v2)\nconst requests = [];\nconst originals = [];\n\nfor (let i = 0; i < items.length && i < 100; i++) { // <= limit 100\n  const item = items[i];\n  let base64 =\n    item.binary?.data?.data?.toString('base64') ||\n    item.json?.base64 ||\n    item.json?.file_base64 ||\n    null;\n\n  if (!base64) continue;\n\n  requests.push({\n    image: { content: base64 },\n    features: [{ type: \"DOCUMENT_TEXT_DETECTION\" }],\n    imageContext: { languageHints: [\"th\"] }\n  });\n\n  originals.push({\n    index: i,\n    fileId: item.json?.fileId || null,\n    filename: item.json?.filename || null,\n    chatId: item.json?.chatId || null,\n    media_group_id: item.json?.media_group_id || null\n  });\n}\n\nif (requests.length === 0) {\n  return [{ json: { error: \"à¹„à¸¡à¹ˆà¸¡à¸µà¸£à¸¹à¸›à¹ƒà¸™ batch à¸™à¸µà¹‰\" } }];\n}\n\n// à¸ªà¹ˆà¸‡ batch à¹€à¸”à¸µà¸¢à¸§à¹„à¸› Vision\nreturn [{\n  json: {\n    requests,\n    originals,\n    total: requests.length\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8720,
        -1104
      ],
      "id": "d95a6504-00df-4a8b-a830-f69024b9ceab",
      "name": "Build Vision Requests",
      "executeOnce": true
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“«à¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸ à¹€à¸ªà¸£à¹‡à¸ˆà¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¸„à¹ˆà¸°ðŸœï¸\n\nðŸ“„ à¸ˆà¸³à¸™à¸§à¸™à¸ªà¸¥à¸´à¸›à¸—à¸µà¹ˆà¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥: {{ $items.length }} à¹ƒà¸š\nðŸ“† à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥à¹€à¸¡à¸·à¹ˆà¸­: {{ $now }}\n\nðŸ“ðŸðŸ™ðŸ’›ðŸ«ðŸ…ðŸ‘ðŸ‹â€ðŸŸ©ðŸ‰ðŸ‡ðŸ£ðŸ•ðŸ§ðŸŒ¹ðŸŒºðŸ¦‹ðŸ¥€ðŸ¥©ðŸ¥“ðŸŸðŸ”ðŸŒ½ðŸ¥•ðŸ†ðŸ¥‘\n\nðŸ–ï¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸–à¸¹à¸à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§à¸„à¹ˆà¸°ðŸ’š",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -5536,
        -2144
      ],
      "id": "f329400f-07cf-4997-99c6-de65b2d4878d",
      "name": ">10",
      "webhookId": "b11471a5-95c1-4f15-8ca0-e8d7d1456f21",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“Š à¸£à¸²à¸¢à¸‡à¸²à¸™à¸œà¸¥à¸à¸²à¸£à¸£à¸±à¸šà¸ªà¸¥à¸´à¸›\nðŸ¤ðŸ©¶ðŸ–¤ðŸ¤ŽðŸ’œðŸ©µðŸ’™ðŸ’šðŸ’›ðŸ§¡ðŸ©·â¤ï¸ðŸ’—\nðŸ“„à¸ˆà¸³à¸™à¸§à¸™à¸ªà¸¥à¸´à¸›à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: {{ $('Sumitem').item.json.total_slips }} à¹ƒà¸š\nðŸ’°à¸¢à¸­à¸”à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: {{ $('Sumitem').item.json.total_amount }} à¸šà¸²à¸—\nðŸ“† à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥à¹€à¸¡à¸·à¹ˆà¸­: {{ $now.setZone('Asia/Bangkok').toFormat('dd/MM/yyyy HH:mm:ss', { locale: 'th' }) }}\nðŸŒˆà¸˜à¸™à¸²à¸„à¸²à¸£: {{ $('Sumitem').item.json.items[0]['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}\n\n\nðŸ“ðŸðŸ™ðŸ’›ðŸ«ðŸ…ðŸ‘ðŸ‹â€ðŸŸ©ðŸ‰ðŸ‡ðŸ£ðŸ•ðŸ§ðŸŒ¹ðŸŒºðŸ¦‹ðŸ¥€ðŸ¥©ðŸ¥“ðŸŸðŸ”ðŸŒ½ðŸ¥•ðŸ†ðŸ¥‘\n\nðŸ–ï¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸–à¸¹à¸à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§à¸„à¹ˆà¸°à¸¡à¸²à¸¢à¸šà¸¹ðŸ’",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -4160,
        -1968
      ],
      "id": "3e97c83f-e3b0-4423-970d-f143a34bddf2",
      "name": ">",
      "webhookId": "b11471a5-95c1-4f15-8ca0-e8d7d1456f21",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const itemsIn = items;\nlet total = itemsIn.length;\nlet totalAmount = 0;\nlet banks = {};\nlet lowConfCount = 0;\n\nfor (let i = 0; i < itemsIn.length; i++) {\n  const j = itemsIn[i].json || {};\n  const amt = j['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] || j['amount'] || j['à¸ˆà¸³à¸™à¸§à¸™'] || j['price'] || null;\n  if (amt !== null && amt !== undefined) {\n    const n = parseFloat(String(amt).replace(/[^0-9\\.\\-]/g,''));\n    if (!isNaN(n)) totalAmount += n;\n  }\n  const bank = j['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] || j['fromBank'] || j['bank'] || 'unknown';\n  banks[bank] = (banks[bank] || 0) + 1;\n  if (j['confidence_score'] !== undefined && j['confidence_score'] < 0.8) lowConfCount++;\n}\n\nconst bankSummary = Object.entries(banks).map(([b,c]) => `${b}:${c}`).join(', ');\nconst formattedTotal = totalAmount ? totalAmount.toFixed(2) : null;\n\nconst summary = {\n  total_slips: total,\n  total_amount: formattedTotal,\n  bank_summary: bankSummary,\n  low_confidence_count: lowConfCount,\n  preview: itemsIn.slice(0,5).map(it => ({\n    name_from: it.json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] || it.json['from'] || null,\n    name_to: it.json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] || it.json['to'] || null,\n    amount: it.json['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] || null,\n    reference: it.json['à¹€à¸¥à¸‚à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡'] || null\n  })),\n  items: itemsIn.map(it => it.json)\n};\n\nreturn [{ json: summary }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4800,
        -1856
      ],
      "id": "2ce3a43e-91b5-4553-985d-17067f6dd975",
      "name": "Sumitem",
      "executeOnce": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "9863ccc4-2ac9-4165-9d52-7752b62fefb1",
              "leftValue": "={{ $json.total_slips }}",
              "rightValue": 3,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4560,
        -1856
      ],
      "id": "1979d88b-ddab-441b-a308-77acc02f408f",
      "name": "count"
    },
    {
      "parameters": {
        "batchSize": 10,
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -4768,
        -1696
      ],
      "id": "f40f6f65-5cc0-4ef2-8da6-d6cd02f7950f",
      "name": "Loop Over Items2",
      "disabled": true
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me2",
      "typeVersion": 1,
      "position": [
        -4608,
        -1648
      ],
      "id": "01a70770-e5c1-43b6-b75d-998b381a3b1f"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“«à¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸ à¹€à¸ªà¸£à¹‡à¸ˆà¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¸„à¹ˆà¸°ðŸœï¸\nðŸ§‘â€ðŸš€à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™ : {{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™'] }}\nðŸ‹ï¸à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š : {{ $json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}\nðŸ’°à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™ : {{ $json['à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™'] }} à¸šà¸²à¸—\nâ°à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£ : {{ $('Switch').item.json.raw_parsed['à¸§à¸±à¸™à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£'] }}\nðŸ“ðŸ¥‘ðŸŒ½ðŸ‡ðŸ“ðŸ†âœ¨ðŸ‡ðŸ¤¶ðŸœï¸ðŸŒŠðŸª¬ðŸ©ºðŸ’°ðŸª™â˜Žï¸ðŸ—ï¸ðŸª’ðŸª­ðŸ§£ðŸ¥½ðŸ–ï¸ðŸ«§ðŸ§½ðŸª¥\nà¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³ :{{ $json['à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³'] }}\nðŸŒˆà¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£ :{{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -5232,
        -2144
      ],
      "id": "1fc46546-7466-4abc-96c6-1425e770b32e",
      "name": "SAVE1",
      "webhookId": "b11471a5-95c1-4f15-8ca0-e8d7d1456f21",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// Function node: Split array-of-files into separate items\n// Place this right after the node that returns a single item containing an array of files.\n\nconst out = [];\nconst src = $json.files || $json.images || $json.originals || $json.items || $json.payload || $json; // try common names\n// if src is object with key, try known paths:\nif (!$json.files && $json.body && Array.isArray($json.body.files)) {\n  src = $json.body.files;\n}\n\n// If src is not array, try to find any array of objects inside $json\nif (!Array.isArray(src)) {\n  // try to find first array inside $json\n  for (const k of Object.keys($json)) {\n    if (Array.isArray($json[k]) && $json[k].length > 0) {\n      src = $json[k];\n      break;\n    }\n  }\n}\n\nif (!Array.isArray(src)) {\n  // nothing to split â€” return original item so upstream doesn't break\n  return items;\n}\n\n// create one output item per file\nfor (let i = 0; i < src.length; i++) {\n  out.push({ json: src[i] });\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -9296,
        -1104
      ],
      "id": "2386699c-8a9f-4da1-9eb1-126ac49d6bb8",
      "name": "Split"
    },
    {
      "parameters": {
        "jsCode": "//  Split Google Vision Responses (Final Version)\n// Input: HTTP Vision Response (1 item) -> Output: N items (1 à¸•à¹ˆà¸­à¸£à¸¹à¸›)\n\nconst out = [];\n\n//  à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ HTTP node à¸­à¸¢à¹ˆà¸²à¸‡à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡\nconst httpOut = items?.[0]?.json || $json || {};\n\n//  à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ responses (Vision output)\nconst responses =\n  httpOut.body?.responses ||   // à¸›à¸à¸•à¸´ HTTP node\n  httpOut.responses ||         // fallback\n  [];\n\n//  à¸”à¸¶à¸‡ originals à¸ˆà¸²à¸ BuildRequests\nconst originals =\n  httpOut.originals ||\n  httpOut.json?.originals ||\n  httpOut.metadata?.originals ||\n  [];\n\n//  à¸ªà¸£à¹‰à¸²à¸‡ item à¹à¸¢à¸à¸—à¸µà¸¥à¸°à¸£à¸¹à¸›\nfor (let i = 0; i < responses.length; i++) {\n  const res = responses[i] || {};\n\n  //  à¹€à¸¥à¸·à¸­à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸”à¸µà¸—à¸µà¹ˆà¸ªà¸¸à¸”\n  const text =\n    res.fullTextAnnotation?.text?.trim() ||\n    res.textAnnotations?.[0]?.description?.trim() ||\n    null;\n\n  const orig = originals[i] || {};\n\n  out.push({\n    json: {\n      index: orig.index ?? i,\n      text,\n      fileId: orig.fileId ?? null,\n      filename: orig.filename ?? null,\n      chatId: orig.chatId ?? null,\n      media_group_id: orig.media_group_id ?? null,\n      visionResponse: res\n    }\n  });\n}\n\n//  à¸à¸£à¸“à¸µ responses à¸§à¹ˆà¸²à¸‡ à¹à¸•à¹ˆ originals à¸¡à¸µ â€” à¸„à¸‡à¸ˆà¸³à¸™à¸§à¸™ item à¹€à¸—à¹ˆà¸²à¹€à¸”à¸´à¸¡\nif (out.length === 0 && originals.length > 0) {\n  for (let j = 0; j < originals.length; j++) {\n    const orig = originals[j];\n    out.push({\n      json: {\n        index: orig.index ?? j,\n        text: null,\n        fileId: orig.fileId ?? null,\n        filename: orig.filename ?? null,\n        chatId: orig.chatId ?? null,\n        media_group_id: orig.media_group_id ?? null,\n        visionResponse: {}\n      }\n    });\n  }\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8224,
        -1104
      ],
      "id": "b7b18ecf-54ac-4100-887c-a23f54065ca2",
      "name": "Split Vision Responses",
      "executeOnce": true
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“«à¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸ à¹€à¸ªà¸£à¹‡à¸ˆà¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¸„à¹ˆà¸°ðŸœï¸\nâ°à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£ :{{ $now.setZone('Asia/Bangkok').toFormat('dd/MM/yyyy HH:mm:ss', { locale: 'th' }) }}\nðŸ’¯ðŸ’—â¤ï¸ðŸ©·ðŸ§¡ðŸ’›ðŸ’šðŸ’™ðŸ©µðŸ’œðŸ¤ŽðŸ–¤ðŸ©¶ðŸ¤ðŸ’¯",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -5984,
        320
      ],
      "id": "272d3d67-211e-49e7-8f3f-5611e91268f2",
      "name": "SAVE2",
      "webhookId": "b11471a5-95c1-4f15-8ca0-e8d7d1456f21",
      "executeOnce": false,
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“«à¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸ à¹€à¸ªà¸£à¹‡à¸ˆà¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¸„à¹ˆà¸°ðŸœï¸\nðŸ§‘â€ðŸš€à¸Šà¸·à¹ˆà¸­à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡ Statement :{{ $('Switch2').item.json['à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¸±à¸š'] }}\nâ°à¸§à¸±à¸™à¹€à¸§à¸¥à¸² à¸—à¸µà¹ˆà¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£ :{{ $now.setZone('Asia/Bangkok').toFormat('dd/MM/yyyy HH:mm:ss', { locale: 'th' }) }}\nðŸ“ðŸ¥‘ðŸ‡ðŸ“ðŸ†âœ¨ðŸ‡ðŸ¤¶ðŸœï¸ðŸŒŠðŸª¬ðŸ©ºðŸ’°ðŸª™â˜Žï¸ðŸ—ï¸ðŸª’ðŸª­ðŸ§£ðŸ–ï¸ðŸ«§ðŸ§½ðŸª¥\nðŸŒˆà¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£ :{{ $json['à¸ˆà¸²à¸à¸˜à¸™à¸²à¸„à¸²à¸£'] }}\nðŸ’¯ðŸ’—â¤ï¸ðŸ©·ðŸ§¡ðŸ’›ðŸ’šðŸ’™ðŸ©µðŸ’œðŸ¤ŽðŸ–¤ðŸ©¶ðŸ¤ðŸ’¯",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -6032,
        -16
      ],
      "id": "d0ca2e69-6e48-45ba-a9aa-f3d6453d3d81",
      "name": "SAVE4",
      "webhookId": "b11471a5-95c1-4f15-8ca0-e8d7d1456f21",
      "credentials": {
        "telegramApi": {
          "id": "SmHWtWDFEcA6wGD9",
          "name": "Telegram account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  item.json.myNewField = 1;\n}\n\nreturn $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5776,
        320
      ],
      "id": "5dbb0bf1-5d8f-41ff-a8e8-11a6d6598cb6",
      "name": "Code in JavaScript",
      "disabled": true
    }
  ],
  "pinData": {},
  "connections": {
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "JS-AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "unk",
            "type": "main",
            "index": 0
          },
          {
            "node": "UNKNOWN1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JS-AI": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "KTB",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MAKE",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "SCB",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "BBL",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MyMo",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "KBank",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "KTB": {
      "main": [
        [
          {
            "node": "GetAllSlips",
            "type": "main",
            "index": 0
          },
          {
            "node": "Sumitem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MAKE": {
      "main": [
        [
          {
            "node": "GetAllSlips",
            "type": "main",
            "index": 0
          },
          {
            "node": "Sumitem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SCB": {
      "main": [
        [
          {
            "node": "GetAllSlips",
            "type": "main",
            "index": 0
          },
          {
            "node": "Sumitem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BBL": {
      "main": [
        [
          {
            "node": "GetAllSlips",
            "type": "main",
            "index": 0
          },
          {
            "node": "Sumitem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MyMo": {
      "main": [
        [
          {
            "node": "GetAllSlips",
            "type": "main",
            "index": 0
          },
          {
            "node": "Sumitem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "bigestF": {
      "main": [
        [
          {
            "node": "Switch Type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ParseSlip": {
      "main": [
        [
          {
            "node": "QC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "unk": {
      "main": [
        [
          {
            "node": "Date & Time",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "UNKNOWN1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Type": {
      "main": [
        [
          {
            "node": "Sent Slip",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Sent Stm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Merge slip/stm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Switch Types",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BOT": {
      "main": [
        [
          {
            "node": "Cal THB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Statement": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sent Stm": {
      "main": [
        [
          {
            "node": "get file stm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sent Slip": {
      "main": [
        [
          {
            "node": "Get a file Slip",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get file stm": {
      "main": [
        [
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a file Slip": {
      "main": [
        [
          {
            "node": "Split",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File": {
      "main": [
        [
          {
            "node": "merg/page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MATCH1": {
      "main": [
        [
          {
            "node": "Format for Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Horse": {
      "main": [
        [
          {
            "node": "Pre-Check",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Post-Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Answer Query a callback": {
      "main": [
        [
          {
            "node": "Horse",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Blacklist/Sheets": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "found",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "unfound",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post-Check": {
      "main": [
        [
          {
            "node": "bigestF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge slip/stm": {
      "main": [
        [
          {
            "node": "Collect All Accounts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mstatement": {
      "main": [
        [
          {
            "node": "Blacklist/Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UserReplyAc": {
      "main": [
        [
          {
            "node": "4Cache",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CheckBlack": {
      "main": [
        [
          {
            "node": "Isblack",
            "type": "main",
            "index": 0
          },
          {
            "node": "SplitRecords",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Unblack",
            "type": "main",
            "index": 0
          },
          {
            "node": "SplitRecords",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NumAc": {
      "main": [
        [
          {
            "node": "CheckBlack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Collect All Accounts": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "Batch Blacklist Check",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Replace Me1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Batch Blacklist Check": {
      "main": [
        [
          {
            "node": "Aggregate BL Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate BL Results": {
      "main": [
        [
          {
            "node": "MATCH1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "merg/page": {
      "main": [
        [
          {
            "node": "AI Agent2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Unblack": {
      "main": [
        []
      ]
    },
    "Format for Sheets": {
      "main": [
        [
          {
            "node": "m_results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "QC": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "main": [
        [
          {
            "node": "BOT",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cal THB": {
      "main": [
        [
          {
            "node": "exchanges",
            "type": "main",
            "index": 0
          },
          {
            "node": "$",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Types": {
      "main": [
        [
          {
            "node": "Answer Query a callback",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "UserReplyAc",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "bigestF",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Inline",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dashboard": {
      "main": [
        [
          {
            "node": "Mstatement",
            "type": "main",
            "index": 0
          },
          {
            "node": "recap",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "KBank": {
      "main": [
        [
          {
            "node": "GetAllSlips",
            "type": "main",
            "index": 0
          },
          {
            "node": "Sumitem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "StmSCB",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "StmKB",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "StmBBL",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "StmMymo",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "StmMBK",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "StmKTb",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "StmSCB": {
      "main": [
        [
          {
            "node": "Getscb1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "StmKB": {
      "main": [
        [
          {
            "node": "Getscb1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "StmKTb": {
      "main": [
        [
          {
            "node": "Getscb1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "StmBBL": {
      "main": [
        [
          {
            "node": "Getscb1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "StmMymo": {
      "main": [
        [
          {
            "node": "Getscb1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "StmMBK": {
      "main": [
        [
          {
            "node": "Getscb1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Getscb1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "GetAllSlips": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "bank-detail": {
      "main": [
        [
          {
            "node": "Extract Fullname & Prepare",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "name-sum": {
      "main": [
        [
          {
            "node": "MergeName",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ac or Name?": {
      "main": [
        [
          {
            "node": "bank-detail",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "name-del",
            "type": "main",
            "index": 0
          },
          {
            "node": "name-sum",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "name-del": {
      "main": [
        [
          {
            "node": "MergeName",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Extract Fullname & Prepare": {
      "main": [
        [
          {
            "node": "name-sum4Bank",
            "type": "main",
            "index": 0
          },
          {
            "node": "name-del4Bank",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "name-sum4Bank": {
      "main": [
        [
          {
            "node": "Merge Bank Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "name-del4Bank": {
      "main": [
        [
          {
            "node": "Merge Bank Results",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge Bank Results": {
      "main": [
        [
          {
            "node": "NumAc",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MergeName": {
      "main": [
        [
          {
            "node": "NumAc",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SplitRecords": {
      "main": [
        [
          {
            "node": "blCheck",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "4Cache": {
      "main": [
        [
          {
            "node": "ProcessLookup",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ProcessLookup": {
      "main": [
        [
          {
            "node": "DecideUseCache",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DecideUseCache": {
      "main": [
        [
          {
            "node": "FormatCachedData",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Ac or Name?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FormatCachedData": {
      "main": [
        [
          {
            "node": "CheckBlack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CloudVission": {
      "main": [
        [
          {
            "node": "Split Vision Responses",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File1": {
      "main": [
        [
          {
            "node": "Build Vision Requests",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Vision Requests": {
      "main": [
        [
          {
            "node": "CloudVission",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sumitem": {
      "main": [
        [
          {
            "node": "count",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "count": {
      "main": [
        [
          {
            "node": ">",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "SAVE",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items2": {
      "main": [
        [],
        [
          {
            "node": "Replace Me2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me2": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split": {
      "main": [
        [
          {
            "node": "Extract from File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Vision Responses": {
      "main": [
        [
          {
            "node": "ParseSlip",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Isblack": {
      "main": [
        []
      ]
    },
    "AI Agent2": {
      "main": [
        [
          {
            "node": "Statement",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CloudVission1": {
      "main": [
        []
      ]
    },
    "SAVE2": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "4bdcfbca-9f08-41e5-a8f5-e18736af0ee1",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9061a45f5132de8a0693d985ecddd8c16c8ca6a41cd187c7df8dc6f5a4c7da2d"
  },
  "id": "qSrzk5Jb46zbFX82",
  "tags": []
}